{% extends "blog/base.html" %}
{% load static i18n blog_tags %}

{% block sidebar %}
{% comment %}
Includes the user sidebar for authenticated users.
{% endcomment %}
{% include 'accounts/user_sidebar.html' %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'accounts/css/admin_badges.css' %}">
{% endblock %}

{% block content %}
{% comment %}
This template displays a list of available quiz topics.
All static text is localized using {% trans %} for English msgid and translations.
{% endcomment %}
<article class="quizes active" data-page="quizes">
  <header>
    <h1 class="h2 article-title">{% trans "Quizzes" %}</h1>
  </header>

  <section class="service">
    <h3 class="h3 service-title">{% trans "Available Topics" %}</h3>

    <ul class="service-list">
      {% if topics %}
          {% for topic in topics %}
            <li class="service-item">
              <a href="{% url 'blog:quiz_detail' quiz_type=topic.name|lower %}" class="service-link">
                <div class="service-icon-box">
                  <img src="{{ topic.icon }}" alt="{% blocktrans with topic_name=topic.name %}{{ topic_name }} icon{% endblocktrans %}" width="40">
                </div>
                <div class="service-content-box">
                  <h4 class="h4 service-item-title">{{ topic.name }}</h4>
                  
                  {% if user.is_authenticated %}
                    {% if topic.questions_count and topic.questions_count > 0 %}
                      {% if topic.completed_tasks_count is not None %}
                        {% widthratio topic.completed_tasks_count topic.questions_count 100 as progress_percentage %}
                        <div class="progress-info">
                          <div class="progress-stats">
                            <span class="progress-stat-item total">
                              <span class="stat-label">{% trans "Total" %}:</span>
                              <span class="stat-value">{{ topic.questions_count }}</span>
                            </span>
                            <span class="progress-stat-item completed">
                              <span class="stat-label">{% trans "Completed" %}:</span>
                              <span class="stat-value">{{ topic.completed_tasks_count }}</span>
                            </span>
                            <span class="progress-stat-item remaining">
                              <span class="stat-label">{% trans "Remaining" %}:</span>
                              <span class="stat-value">{{ topic.remaining_tasks_count }}</span>
                            </span>
                          </div>
                          <div class="progress-bar-container">
                            <div class="progress-bar" style="width: {{ progress_percentage }}%;"></div>
                          </div>
                          <div class="progress-percentage">
                            <strong>{{ progress_percentage }}%</strong> {% trans "complete" %}
                          </div>
                        </div>
                      {% else %}
                        <div class="progress-info">
                          <div class="progress-stats">
                            <span class="progress-stat-item total">
                              <span class="stat-label">{% trans "Total" %}:</span>
                              <span class="stat-value">{{ topic.questions_count }}</span>
                            </span>
                          </div>
                          <p class="progress-text not-started">{% trans "Not started" %}</p>
                        </div>
                      {% endif %}
                    {% else %}
                      <p class="no-tasks">{% trans "No items in topic" %}</p>
                    {% endif %}
                  {% else %}
                    {% if topic.questions_count and topic.questions_count > 0 %}
                      <div class="progress-info">
                        <div class="progress-stats">
                          <span class="progress-stat-item total">
                            <span class="stat-label">{% trans "Total" %}:</span>
                            <span class="stat-value">{{ topic.questions_count }}</span>
                          </span>
                        </div>
                        <p class="progress-text not-started">{% trans "Log in to track your progress" %}</p>
                      </div>
                    {% else %}
                      <p class="no-tasks">{% trans "No items in topic" %}</p>
                    {% endif %}
                  {% endif %}
                </div>
              </a>
            </li>
          {% endfor %}
      {% else %}
          <li class="service-item">
              <div class="service-icon-box">
                  <img src="{% static 'blog/images/icons/default-icon.png' %}" alt="{% trans 'No topics' %}" width="36">
              </div>
              <div class="service-content-box">
                  <h4 class="h4 service-item-title">{% trans "No Quizzes Available" %}</h4>
                  <p class="service-item-text">{% trans "There are no quiz topics available at the moment." %}</p>
              </div>
          </li>
      {% endif %}
    </ul>
  </section>

  <div class="user-score">
    {% if user.is_authenticated %}
    <a href="{% url 'blog:statistics' %}?view=personal" class="contact-link">{% trans "View my progress" %}</a>
    {% else %}
        <a href="#" class="open-login-modal" data-return-url="{{ request.path }}">{% trans "Log in to track progress" %}</a>
    {% endif %}
  </div>
</article>

<style>
  .service-link {
    text-decoration: none;
    color: inherit;
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 10px;
  }

  .service-item:hover {
    transform: scale(1.05);
    transition: transform 0.3s ease;
  }
</style>

<script src="{% static_versioned 'blog/js/progress-update.js' %}" defer></script>
{% endblock %}