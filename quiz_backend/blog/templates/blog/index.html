{% extends "blog/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'blog/css/resources.css' %}">
{% endblock %}

{% block content %}
<!-- about -->
<article class="about active" data-page="about">
    <header>
        <h2 class="h2 article-title">Home</h2>
    </header>

    <section class="about-text">
        {% for paragraph in personal_info.home_text %}
            <p>{{ paragraph }}</p>
        {% endfor %}
    </section>

    <section class="service">
        <h3 class="h3 service-title">Чем я занимаюсь</h3>

        <ul class="service-list">
            <li class="service-item">
                <div class="service-icon-box">
                    <img src="https://cdn-icons-png.flaticon.com/512/1087/1087927.png" alt="icon" width="40">
                </div>

                <div class="service-content-box">
                    <h4 class="h4 service-item-title">Веб-дизайн</h4>
                    <p class="service-item-text">Самый современный и высококачественный дизайн, созданный на профессиональном уровне.</p>
                </div>
            </li>

            <li class="service-item">
                <div class="service-icon-box">
                    <img src="https://cdn-icons-png.flaticon.com/512/1197/1197460.png" alt="icon" width="40">
                </div>

                <div class="service-content-box">
                    <h4 class="h4 service-item-title">Веб-разработка</h4>
                    <p class="service-item-text">Высококачественная разработка сайтов на профессиональном уровне.</p>
                </div>
            </li>

            <li class="service-item">
                <div class="service-icon-box">
                    <img src="https://cdn-icons-png.flaticon.com/512/2232/2232241.png" alt="icon" width="40">
                </div>

                <div class="service-content-box">
                    <h4 class="h4 service-item-title">Мобильные приложения</h4>
                    <p class="service-item-text">Профессиональная разработка приложений для iOS и Android.</p>
                </div>
            </li>

            <li class="service-item">
                <div class="service-icon-box">
                    <img src="https://cdn-icons-png.flaticon.com/512/1042/1042339.png" alt="icon" width="40">
                </div>

                <div class="service-content-box">
                    <h4 class="h4 service-item-title">Фотография</h4>
                    <p class="service-item-text">Я делаю высококачественные фотографии любой категории на профессиональном уровне.</p>
                </div>
            </li>
        </ul>
    </section>

    <section class="testimonials">
        <h3 class="h3 testimonials-title">Топ пользователей</h3>

        <ul class="testimonials-list has-scrollbar">
            {% for user in personal_info.top_users %}
            <li class="testimonials-item">
                <div class="content-card" data-testimonials-item>
                    <figure class="testimonials-avatar-box">
                        <img src="{{ user.avatar }}" alt="avatar" data-testimonials-avatar width="60">
                    </figure>

                    <h4 class="h4 testimonials-item-title" data-testimonials-title>{{ user.name }}</h4>
                    <div class="user-stats">
                        <span class="rank">Ранг: #{{ user.rank }}</span>
                        <span class="score">Очки: {{ user.total_score|floatformat:0 }}</span>
                    </div>

                    <div class="testimonials-text" data-testimonials-text>
                        <p>Пройдено викторин: {{ user.quizzes_count }}</p>
                        <p>Средний результат: {{ user.avg_score }}%</p>
                        <p>Любимая категория: {{ user.favorite_category }}</p>
                    </div>
                </div>
            </li>
            {% empty %}
            <li class="testimonials-item">
                <div class="content-card">
                    <p>Пока нет данных о пользователях</p>
                </div>
            </li>
            {% endfor %}
        </ul>
    </section>

    <div class="modal-container" data-modal-container>
        <div class="overlay" data-overlay></div>

        <section class="testimonials-modal">
            <button class="modal-close-btn" data-modal-close-btn><ion-icon name="close-outline"></ion-icon></button>

            <div class="modal-img-wrapper">
                <figure class="modal-avatar-box">
                    <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80" alt="Daniel Lewis" width="80" data-modal-img>
                </figure>

                <img src="https://cdn-icons-png.flaticon.com/512/6364/6364343.png" alt="quote icon">
            </div>

            <div class="modal-content">
                <h4 class="h3 modal-title" data-modal-title>Daniel Lewis</h4>
                <time datetime="2023-06-14">14 June, 2023</time>

                <div class="modal-text" data-modal-text>
                    <p>Richard was hired to create a corporate identity. It's modern, clean and with a beautiful design that got a lot of praises from colleagues and visitors. We were very pleased with the work done. He has a lot of experience and is very concerned about the needs of client.</p>
                </div>
            </div>
        </section>
    </div>

    <!-- 4. Наши ресурсы (clients) -->
    <section class="clients">
        <h3 class="h3 clients-title">Наши ресурсы</h3>

        <ul class="clients-list has-scrollbar">
            {% for key, resource in personal_info.resources.items %}
            <li class="clients-item">
                <a href="{{ resource.url }}" target="_blank" title="{{ resource.name }}">
                    <img src="{{ resource.icon }}" alt="{{ resource.name }}">
                </a>
            </li>
            {% endfor %}
        </ul>
    </section>

    <section class="skill">
        <h3 class="h3 skills-title">Popular Quizzes</h3>

        <ul class="skills-list content-card">
            <li class="skills-item quiz-card" data-quiz-id="1" onclick="showQuizStats(1)">
                <div class="title-wrapper">
                    <h5 class="h5">Programming Basics</h5>
                    <data value="80">80% популярность</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 80%;"></div>
                </div>
            </li>

            <li class="skills-item quiz-card" data-quiz-id="2" onclick="showQuizStats(2)">
                <div class="title-wrapper">
                    <h5 class="h5">World History</h5>
                    <data value="70">70% популярность</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 70%;"></div>
                </div>
            </li>

            <li class="skills-item quiz-card" data-quiz-id="3" onclick="showQuizStats(3)">
                <div class="title-wrapper">
                    <h5 class="h5">Science Quiz</h5>
                    <data value="90">90% популярность</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 90%;"></div>
                </div>
            </li>

            <li class="skills-item quiz-card" data-quiz-id="4" onclick="showQuizStats(4)">
                <div class="title-wrapper">
                    <h5 class="h5">Literature Masters</h5>
                    <data value="50">50% популярность</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 50%;"></div>
                </div>
            </li>
        </ul>
    </section>

    <!-- Добавляем модальное окно для статистики -->
    <div class="quiz-stats-modal" id="quizStatsModal">
        <div class="modal-content">
            <span class="close-stats-modal">&times;</span>
            <h2 id="quizStatsTitle">Quiz Statistics</h2>
            <canvas id="quizStatsChart"></canvas>
        </div>
    </div>
</article>

<article class="clients" data-page="clients">
    <header>
        <h2 class="h2 article-title">Users</h2>
    </header>

    <section class="clients-list">
        {% for user in users %}
        <div class="client-card">
            <figure class="client-avatar-box">
                <img src="{% static 'blog/images/avatar/default_avatar.png' %}" alt="{{ user.username }}" class="client-avatar">
            </figure>

            <div class="client-info">
                <h3 class="client-name">
                    <a href="{% url 'user-profile' username=user.username %}">{{ user.username }}</a>
                </h3>
                
                {% if user.profile.location %}
                <p class="client-location">
                    <ion-icon name="location-outline"></ion-icon>
                    <span>{{ user.profile.location }}</span>
                </p>
                {% endif %}

                {% if user.profile.bio %}
                <p class="client-bio">{{ user.profile.bio|truncatewords:20 }}</p>
                {% endif %}

                <div class="client-stats">
                    <div class="stat">
                        <ion-icon name="trophy-outline"></ion-icon>
                        <span>Points: {{ user.profile.total_points }}</span>
                    </div>
                    <div class="stat">
                        <ion-icon name="checkbox-outline"></ion-icon>
                        <span>Quizzes: {{ user.profile.quizzes_completed }}</span>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <p class="no-clients">No users found.</p>
        {% endfor %}
    </section>
</article>

<!-- Отладочная информация -->
<div style="display: none;">
    {{ personal_info.resources|json_script:"debug-resources" }}
</div>

{% endblock %}

<!-- Добавляем необходимые скрипты -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'blog/js/main.js' %}"></script>
<script>
    function showQuizStats(quizId) {
        const modal = document.getElementById('quizStatsModal');
        const canvas = document.getElementById('quizStatsChart');
        const ctx = canvas.getContext('2d');
        
        // Показываем модальное окно
        modal.style.display = "block";
        
        // Создаем график
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн'],
                datasets: [{
                    label: 'Количество прохождений',
                    data: [65, 59, 80, 81, 56, 55],
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // Закрытие модального окна
    document.querySelector('.close-stats-modal').onclick = function() {
        document.getElementById('quizStatsModal').style.display = "none";
    }
</script>
<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script> 