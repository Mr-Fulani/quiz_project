{% extends "blog/base.html" %}
{% load static youtube_tags i18n %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'blog/css/card_animations.css' %}">
{% endblock %}

{% block content %}
<article class="about active" data-page="about">
    <header>
        <h1 class="h2 article-title">{% trans "About me" %}</h1>
    </header>

    {% with video=page_video %}
        {% if video %}
            {% if video.show_media %}
            <section class="video section-gap">
                <div class="content-card">
                    {# –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤–∏–¥–µ–æ #}
                    <div class="video-desktop">
                        {% if video.media_type == 'video_file' and video.video_file %}
                            <div class="video-banner-box">
                                <video id="local-video-about" width="100%" height="400"
                                    autoplay muted loop playsinline
                                    preload="auto"
                                    style="cursor: pointer;"
                                    title="{% trans 'Click to enable sound' %}">
                                    <source src="{{ video.video_file.url }}" type="video/mp4">
                                    {% trans "Your browser does not support the video tag." %}
                                </video>
                            </div>
                        {% elif video.media_type == 'video_url' and video.video_url %}
                            <div class="video-banner-box" id="video-container-about">
                                <iframe id="youtube-player-about"
                                        width="100%" height="400"
                                        src="{{ video.get_youtube_embed_url_with_version:video.video_url }}"
                                        style="border: none; cursor: pointer;"
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                        allowfullscreen
                                        referrerpolicy="strict-origin-when-cross-origin"
                                        loading="lazy"
                                        title="{% trans 'Click to enable sound' %}">
                                </iframe>
                                <noscript>
                                    <div style="padding: 40px; text-align: center; background: #1a1a1a; border-radius: 8px;">
                                        <p style="color: #fff; margin-bottom: 20px;">{% trans "Video requires JavaScript to play." %}</p>
                                        <a href="{{ video.video_url }}" target="_blank" rel="noopener noreferrer" 
                                           style="display: inline-block; padding: 12px 24px; background: #ff6b6b; color: #fff; text-decoration: none; border-radius: 5px;">
                                            {% trans "Watch on YouTube" %}
                                        </a>
                                    </div>
                                </noscript>
                            </div>
                        {% elif video.media_type == 'gif' and video.gif %}
                            <div class="video-banner-box">
                                <img id="gif-about" src="{{ video.gif.url }}" alt="{{ video.title }}" width="100%" height="400" loading="eager">
                            </div>
                        {% endif %}
                    </div>
                    
                    {# –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤–∏–¥–µ–æ #}
                    {% if video.mobile_media_type %}
                        <div class="video-mobile">
                            {% if video.mobile_media_type == 'video_file' and video.mobile_video_file %}
                                <div class="video-banner-box">
                                    <video id="local-video-about-mobile"
                                        width="100%" height="400"
                                        autoplay muted loop playsinline
                                        preload="auto"
                                        style="cursor: pointer;"
                                        title="{% trans 'Click to enable sound' %}">
                                        <source src="{{ video.mobile_video_file.url }}" type="video/mp4">
                                        {% trans "Your browser does not support the video tag." %}
                                    </video>
                                </div>
                            {% elif video.mobile_media_type == 'video_url' and video.mobile_video_url %}
                                <div class="video-banner-box" id="video-container-about-mobile">
                                    <iframe id="youtube-player-about-mobile"
                                            width="100%" height="400"
                                            src="{{ video.mobile_youtube_embed_url_versioned }}"
                                            style="border: none; cursor: pointer;"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                            allowfullscreen
                                            referrerpolicy="strict-origin-when-cross-origin"
                                            loading="lazy"
                                            title="{% trans 'Click to enable sound' %}">
                                    </iframe>
                                    <noscript>
                                        <div style="padding: 40px; text-align: center; background: #1a1a1a; border-radius: 8px;">
                                            <p style="color: #fff; margin-bottom: 20px;">{% trans "Video requires JavaScript to play." %}</p>
                                            <a href="{{ video.mobile_video_url }}" target="_blank" rel="noopener noreferrer" 
                                               style="display: inline-block; padding: 12px 24px; background: #ff6b6b; color: #fff; text-decoration: none; border-radius: 5px;">
                                                {% trans "Watch on YouTube" %}
                                            </a>
                                        </div>
                                    </noscript>
                                </div>
                            {% elif video.mobile_media_type == 'gif' and video.mobile_gif %}
                                <div class="video-banner-box">
                                    <img id="gif-about-mobile" src="{{ video.mobile_gif.url }}" alt="{{ video.title }}" width="100%" height="400" loading="eager">
                                </div>
                            {% endif %}
                        </div>
                    {% else %}
                        {# –ï—Å–ª–∏ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –≤–∏–¥–µ–æ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Ç–æ–∂–µ #}
                        <div class="video-mobile">
                            {% if video.media_type == 'video_file' and video.video_file %}
                                <div class="video-banner-box">
                                    <video id="local-video-about-mobile"
                                        width="100%" height="400"
                                        autoplay muted loop playsinline
                                        preload="auto"
                                        style="cursor: pointer;"
                                        title="{% trans 'Click to enable sound' %}">
                                        <source src="{{ video.video_file.url }}" type="video/mp4">
                                        {% trans "Your browser does not support the video tag." %}
                                    </video>
                                </div>
                            {% elif video.media_type == 'video_url' and video.video_url %}
                                <div class="video-banner-box" id="video-container-about-mobile">
                                    <iframe id="youtube-player-about-mobile"
                                            width="100%" height="400"
                                            src="{{ video.youtube_embed_url_versioned }}"
                                            style="border: none; cursor: pointer;"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                            allowfullscreen
                                            referrerpolicy="strict-origin-when-cross-origin"
                                            loading="lazy"
                                            title="{% trans 'Click to enable sound' %}">
                                    </iframe>
                                    <noscript>
                                        <div style="padding: 40px; text-align: center; background: #1a1a1a; border-radius: 8px;">
                                            <p style="color: #fff; margin-bottom: 20px;">{% trans "Video requires JavaScript to play." %}</p>
                                            <a href="{{ video.video_url }}" target="_blank" rel="noopener noreferrer" 
                                               style="display: inline-block; padding: 12px 24px; background: #ff6b6b; color: #fff; text-decoration: none; border-radius: 5px;">
                                                {% trans "Watch on YouTube" %}
                                            </a>
                                        </div>
                                    </noscript>
                                </div>
                            {% elif video.media_type == 'gif' and video.gif %}
                                <div class="video-banner-box">
                                    <img id="gif-about-mobile" src="{{ video.gif.url }}" alt="{{ video.title }}" width="100%" height="400" loading="eager">
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            </section>
            {% endif %}

            {% if video.show_text %}
            <section class="about-text section-gap">
                {% if video.text_content %}
                    {{ video.text_content|linebreaks }}
                {% else %}
                    {% for paragraph in personal_info.about_text %}
                        <p>{{ paragraph }}</p>
                    {% endfor %}
                {% endif %}
            </section>
            {% endif %}
        {% else %}
            <section class="about-text section-gap">
                {% for paragraph in personal_info.about_text %}
                    <p>{{ paragraph }}</p>
                {% endfor %}
            </section>
        {% endif %}
    {% endwith %}

    <section class="service">
        <h3 class="h3 service-title">{% trans "What I do" %}</h3>

        <ul class="service-list">
            <li class="service-item">
                <a href="{% url 'blog:portfolio' %}?category=web" title="{% trans 'Development of websites and web applications' %}">
                    <div class="service-icon-box">
                        <img src="https://cdn-icons-png.flaticon.com/128/1197/1197460.png" alt="{% trans 'Web development icon' %}" width="40" height="40">
                    </div>

                    <div class="service-content-box">
                        <h4 class="h4 service-item-title">{% trans "Web Development" %}</h4>
                        <p class="service-item-text">{% trans "High-quality website development at a professional level." %}</p>
                    </div>
                </a>
            </li>

            <li class="service-item">
                <a href="{% url 'blog:portfolio' %}?category=telegram-apps" title="{% trans 'Development of Telegram mini-apps' %}">
                    <div class="service-icon-box">
                        <img src="https://cdn-icons-png.flaticon.com/128/2111/2111644.png" alt="{% trans 'Telegram Mini Apps icon' %}" width="40" height="40">
                    </div>

                    <div class="service-content-box">
                        <h4 class="h4 service-item-title">{% trans "Telegram Mini-App" %}</h4>
                        <p class="service-item-text">{% trans "Development of interactive mini-applications for Telegram with integration into the messenger ecosystem." %}</p>
                    </div>
                </a>
            </li>

            <li class="service-item">
                <a href="{% url 'blog:portfolio' %}?category=bots" title="{% trans 'Creation of Telegram bots' %}">
                    <div class="service-icon-box">
                        <img src="https://cdn-icons-png.flaticon.com/128/3480/3480317.png" alt="{% trans 'Telegram bots icon' %}" width="40" height="40">
                    </div>

                    <div class="service-content-box">
                        <h4 class="h4 service-item-title">{% trans "Telegram Bots" %}</h4>
                        <p class="service-item-text">{% trans "Development of Telegram bots of any complexity with integration into various APIs." %}</p>
                    </div>
                </a>
            </li>

            <li class="service-item">
                <a href="{% url 'blog:portfolio' %}?category=automation" title="{% trans 'Business process automation' %}">
                    <div class="service-icon-box">
                        <img src="https://cdn-icons-png.flaticon.com/128/1055/1055687.png" alt="{% trans 'Automation icon' %}" width="40" height="40">
                    </div>

                    <div class="service-content-box">
                        <h4 class="h4 service-item-title">{% trans "Automation" %}</h4>
                        <p class="service-item-text">{% trans "Creating scripts and programs to automate routine tasks and business processes." %}</p>
                    </div>
                </a>
            </li>
        </ul>
    </section>

    <section class="testimonials">
        <div class="testimonials-header">
            <div class="testimonials-buttons">
                <div class="view-all-testimonials">
                    <a href="{% url 'blog:all_testimonials' %}" class="btn">
                        <ion-icon name="list-outline"></ion-icon>
                        {% trans "All Feedback" %}
                    </a>
                </div>
                <div class="add-testimonial-button">
                    {% if user.is_authenticated %}
                        <button class="btn" type="button">
                            <ion-icon name="add-outline"></ion-icon>
                            {% trans "Leave Feedback" %}
                        </button>
                    {% else %}
                        <a href="#" class="btn open-login-modal" data-return-url="{{ request.path }}">
                            <ion-icon name="add-outline"></ion-icon>
                            {% trans "Leave Feedback" %}
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
        <ul class="testimonials-list has-scrollbar">
            {% for testimonial in testimonials|slice:"3" %}
            <li class="testimonials-item" data-username="{{ testimonial.user.username }}">
                <div class="content-card" data-testimonials-item>
                    <figure class="testimonials-avatar-box">
                        {% if testimonial.user.avatar %}
                            <img src="{% if testimonial.user.avatar_thumbnail.url %}{{ testimonial.user.avatar_thumbnail.url }}{% else %}{{ testimonial.user.avatar.url }}{% endif %}" alt="avatar" data-testimonials-avatar width="60" height="60" loading="lazy">
                        {% else %}
                            <img src="{% static 'blog/images/avatar/default_avatar.png' %}" alt="avatar" data-testimonials-avatar width="60" height="60" loading="lazy">
                        {% endif %}
                    </figure>

                    <div class="testimonials-content">
                        <h4 class="h4 testimonials-item-title" data-testimonials-title>
                            {{ testimonial.user.username }}
                        </h4>
                        <div class="testimonials-text" data-testimonials-text>
                            <p>{{ testimonial.text }}</p>
                        </div>
                        <time datetime="{{ testimonial.created_at|date:'Y-m-d' }}" data-date-joined>
                            {{ testimonial.created_at|date:"d F, Y" }}
                        </time>
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
    </section>

    {% include "blog/includes/testimonial_modals.html" %}

    <section class="skill">
        <h3 class="h3 skills-title">{% trans "My Skills" %}</h3>

        <ul class="skills-list content-card">
            <li class="skills-item">
                <div class="title-wrapper">
                    <h5 class="h5">{% trans "Python" %}</h5>
                    <data value="80">80%</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 80%;"></div>
                </div>
            </li>

            <li class="skills-item">
                <div class="title-wrapper">
                    <h5 class="h5">{% trans "Django" %}</h5>
                    <data value="70">70%</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 70%;"></div>
                </div>
            </li>

            <li class="skills-item">
                <div class="title-wrapper">
                    <h5 class="h5">{% trans "FastAPI" %}</h5>
                    <data value="90">90%</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 90%;"></div>
                </div>
            </li>

            <li class="skills-item">
                <div class="title-wrapper">
                    <h5 class="h5">{% trans "Flask" %}</h5>
                    <data value="50">50%</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 50%;"></div>
                </div>
            </li>
            <li class="skills-item">
                <div class="title-wrapper">
                    <h5 class="h5">{% trans "SQL" %}</h5>
                    <data value="50">50%</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 50%;"></div>
                </div>
            </li>
            <li class="skills-item">
                <div class="title-wrapper">
                    <h5 class="h5">{% trans "PostgreSQL" %}</h5>
                    <data value="50">50%</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 50%;"></div>
                </div>
            </li>
            <li class="skills-item">
                <div class="title-wrapper">
                    <h5 class="h5">{% trans "Docker" %}</h5>
                    <data value="50">50%</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 50%;"></div>
                </div>
            </li>
            <li class="skills-item">
                <div class="title-wrapper">
                    <h5 class="h5">{% trans "Git" %}</h5>
                    <data value="50">50%</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 50%;"></div>
                </div>
            </li>
            <li class="skills-item">
                <div class="title-wrapper">
                    <h5 class="h5">{% trans "Linux" %}</h5>
                    <data value="50">50%</data>
                </div>

                <div class="skills-progress-bg">
                    <div class="skills-progress-fill" style="width: 50%;"></div>
                </div>
            </li>
        </ul>
    </section>

</article>
{% endblock %}

{% block scripts %}
<script src="{% static 'blog/js/video_control.js' %}"></script>
<script>
    window.defaultAvatarUrl = '{% static "blog/images/avatar/default_avatar.png" %}';
    window.userProfileUrlTemplate = "{% url 'accounts:user_profile' username='__USERNAME__' %}";
</script>
<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ YouTube –≤–∏–¥–µ–æ
function setupYouTubeVideo(iframeId, containerId) {
    const youtubeIframe = document.getElementById(iframeId);
    const container = document.getElementById(containerId);
    
    if (youtubeIframe && container) {
        const embedUrl = youtubeIframe.getAttribute('src');
        console.log('üé¨ YouTube Video Diagnostics:', iframeId);
        console.log('Embed URL:', embedUrl);
        
        // –ò–∑–≤–ª–µ–∫–∞–µ–º Video ID –∏–∑ URL
        const videoIdMatch = embedUrl.match(/embed\/([a-zA-Z0-9_-]+)/);
        if (videoIdMatch) {
            const videoId = videoIdMatch[1];
            const watchUrl = `https://www.youtube.com/watch?v=${videoId}`;
            console.log('Video ID:', videoId);
            console.log('Watch URL:', watchUrl);
            
            // –ñ–¥—ë–º 3 —Å–µ–∫—É–Ω–¥—ã –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å –ª–∏ –≤–∏–¥–µ–æ
            let errorDetected = false;
            
            // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç YouTube
            window.addEventListener('message', function(event) {
                if (event.origin.includes('youtube')) {
                    const data = event.data;
                    if (typeof data === 'string') {
                        try {
                            const parsed = JSON.parse(data);
                            if (parsed.event === 'onError' || parsed.info === 153) {
                                errorDetected = true;
                                showFallback(container, watchUrl, videoId);
                            }
                        } catch (e) {}
                    }
                }
            });
            
            // Fallback –µ—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å –∑–∞ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(function() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å iframe
                const iframeRect = youtubeIframe.getBoundingClientRect();
                if (!errorDetected && (iframeRect.height === 0 || iframeRect.width === 0)) {
                    console.warn('‚ö†Ô∏è –í–∏–¥–µ–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å –∑–∞ 5 —Å–µ–∫—É–Ω–¥');
                    showFallback(container, watchUrl, videoId);
                }
            }, 5000);
            
            function showFallback(container, watchUrl, videoId) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ YouTube –≤–∏–¥–µ–æ');
                console.log('üìå –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:');
                console.log('   1. –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–∏–¥–µ–æ');
                console.log('   2. –í–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ');
                console.log('   3. –í–∏–¥–µ–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–æ');
                
                container.innerHTML = `
                    <div style="padding: 40px; text-align: center; background: #1a1a1a; border-radius: 8px; min-height: 300px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                        <svg style="width: 64px; height: 64px; margin-bottom: 20px; fill: #ff6b6b;" viewBox="0 0 24 24">
                            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4M11,7V13H13V7H11M11,15V17H13V15H11Z" />
                        </svg>
                        <p style="color: #fff; margin-bottom: 20px; font-size: 16px;">{% trans "Video embedding is restricted." %}</p>
                        <a href="${watchUrl}" target="_blank" rel="noopener noreferrer" 
                           style="display: inline-block; padding: 12px 24px; background: #ff0000; color: #fff; text-decoration: none; border-radius: 5px; font-weight: 500;">
                            <svg style="width: 20px; height: 20px; margin-right: 8px; fill: currentColor; vertical-align: middle;" viewBox="0 0 24 24">
                                <path d="M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z" />
                            </svg>
                            {% trans "Watch on YouTube" %}
                        </a>
                        <p style="color: #999; margin-top: 15px; font-size: 14px;">Video ID: ${videoId}</p>
                    </div>
                `;
            }
        }
    }
}

// –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ YouTube iframe (–æ—à–∏–±–∫–∞ 153)
document.addEventListener('DOMContentLoaded', function() {
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–µ –≤–∏–¥–µ–æ
    setupYouTubeVideo('youtube-player-about', 'video-container-about');
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    setupYouTubeVideo('youtube-player-about-mobile', 'video-container-about-mobile');
});
</script>

<!-- Set up localization strings for testimonials.js -->
<script>
window.testimonialsTranslations = {
    'viewProfile': '{% trans "View Profile" %}',
    'loginToViewProfile': '{% trans "Login to view profile" %}',
    'profileUnavailable': '{% trans "Profile unavailable" %}',
    'modalClosed': '{% trans "Modal closed" %}',
    'modalOpened': '{% trans "Modal opened" %}',
    'userNotAuthenticated': '{% trans "User not authenticated, preventing modal open" %}',
    'addTestimonialModalOpened': '{% trans "Add testimonial modal opened" %}',
    'addTestimonialButtonNotFound': '{% trans "Add testimonial button not found" %}',
    'addTestimonialModalNotFound': '{% trans "Add testimonial modal not found" %}',
    'modalNotFoundForClosing': '{% trans "Modal not found for closing" %}',
    'thankYouTestimonialAdded': '{% trans "Thank you! Your testimonial has been successfully added." %}',
    'errorSubmittingTestimonial': '{% trans "An error occurred while submitting the testimonial. Please try again." %}',
    'addTestimonialButtonClicked': '{% trans "Add testimonial button clicked, isAuthenticated:" %}'
};
</script>

<script src="{% static 'blog/js/testimonials.js' %}"></script>
{% endblock %}