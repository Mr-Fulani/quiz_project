<!DOCTYPE html>
{% load static i18n %}
{% get_current_language as language %}
<html lang="{{ language }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ dynamic_seo.meta_title|default:meta_title|default:"QuizHub - Programming Quizzes & Learning" }}{% endblock %}</title>
    
    <!-- Basic Meta Tags -->
    <meta name="description" content="{% block meta_description %}{{ dynamic_seo.meta_description|default:meta_description|truncatechars:160|default:'Master programming with interactive quizzes and tutorials.' }}{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}{{ dynamic_seo.meta_keywords|default:meta_keywords|default:'programming quiz, coding challenges, learning platform' }}{% endblock %}">
    <meta name="author" content="{{ meta_author|default:'Anvar Sh.' }}">
    <meta name="copyright" content="{{ meta_copyright }}">
    <meta name="rating" content="{{ meta_rating|default:'general' }}">
    <meta name="distribution" content="{{ meta_distribution|default:'global' }}">
    <meta name="revisit-after" content="{{ meta_revisit_after|default:'7 days' }}">
    <meta name="robots" content="{% block meta_robots %}{{ dynamic_seo.robots_content|default:robots_content|default:'index, follow' }}{% endblock %}">
    
    <!-- Yandex Verification -->
    {% if YANDEX_VERIFICATION_CODE %}
    <meta name="yandex-verification" content="{{ YANDEX_VERIFICATION_CODE }}" />
    {% endif %}
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{% block canonical_url %}{{ dynamic_seo.canonical_url|default:canonical_url }}{% endblock %}">
    
    <!-- Hreflang Tags -->
    {% if hreflang_en %}<link rel="alternate" hreflang="en" href="{{ hreflang_en }}">{% endif %}
    {% if hreflang_ru %}<link rel="alternate" hreflang="ru" href="{{ hreflang_ru }}">{% endif %}
    {% if hreflang_x_default %}<link rel="alternate" hreflang="x-default" href="{{ hreflang_x_default }}">{% endif %}
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="{% block og_title %}{{ dynamic_seo.og_title|default:og_title|default:'QuizHub - Programming Quizzes' }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ dynamic_seo.og_description|default:og_description|truncatechars:200|default:'Master programming with interactive quizzes and tutorials.' }}{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{{ dynamic_seo.og_image|default:og_image|default:'/static/blog/images/default-og-image.jpeg' }}{% endblock %}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/jpeg">

    <meta property="og:url" content="{% block og_url %}{{ dynamic_seo.og_url|default:og_url }}{% endblock %}">
    <meta property="og:type" content="{% block og_type %}{{ dynamic_seo.og_type|default:'website' }}{% endblock %}">
    <meta property="og:site_name" content="{{ og_site_name|default:'QuizHub' }}">
    <meta property="og:locale" content="{{ og_locale|default:'en_US' }}">
    

    
    <!-- Article specific OG tags (for blog posts) -->
    {% if dynamic_seo.article_author %}<meta property="article:author" content="{{ dynamic_seo.article_author }}">{% endif %}
    {% if dynamic_seo.article_published_time %}<meta property="article:published_time" content="{{ dynamic_seo.article_published_time }}">{% endif %}
    {% if dynamic_seo.article_modified_time %}<meta property="article:modified_time" content="{{ dynamic_seo.article_modified_time }}">{% endif %}
    {% if dynamic_seo.article_section %}<meta property="article:section" content="{{ dynamic_seo.article_section }}">{% endif %}
    {% if dynamic_seo.article_tag %}
        {% for tag in dynamic_seo.article_tag %}
            <meta property="article:tag" content="{{ tag }}">
        {% endfor %}
    {% endif %}
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="{{ twitter_card|default:'summary_large_image' }}">
    <meta name="twitter:site" content="{{ twitter_site|default:'@quiz_code_hub' }}">
    <meta name="twitter:creator" content="{{ twitter_creator|default:'@mr_fulani' }}">
    <meta name="twitter:title" content="{% block twitter_title %}{{ dynamic_seo.twitter_title|default:twitter_title|default:'QuizHub - Programming Quizzes' }}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{{ dynamic_seo.twitter_description|default:twitter_description|truncatechars:200|default:'Master programming with interactive quizzes and tutorials.' }}{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{{ dynamic_seo.twitter_image|default:twitter_image|default:'/static/blog/images/default-og-image.jpeg' }}{% endblock %}">

    
    <!-- VK Meta Tags -->
    <meta property="vk:title" content="{{ dynamic_seo.vk_title|default:'QuizHub - Programming Quizzes' }}">
    <meta property="vk:description" content="{{ dynamic_seo.vk_description|default:'Master programming with interactive quizzes and tutorials.' }}">
    <meta property="vk:image" content="{{ dynamic_seo.vk_image|default:'/static/blog/images/default-og-image.jpeg' }}">
    

    

    

    
    <!-- Mobile and App Meta Tags -->
    <meta name="theme-color" content="#1a1a2e">
    <meta name="msapplication-TileColor" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="QuizHub">
    
    <!-- Telegram Mini App specific -->
    {% if is_mini_app %}
        <meta name="telegram-mini-app" content="true">
        <!-- –î–ª—è Telegram Mini App –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –Ω–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CSS –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    {% endif %}

    <!-- Preconnect –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ -->
    <link rel="preconnect" href="https://oauth.telegram.org" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Favicon -->
    <link rel="icon" href="{% static 'blog/favicon/favicon.png' %}" type="image/png">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'blog/favicon/favicon.png' %}">
    {# –î–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–∫–æ–Ω–∫–∏ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–º–µ—Ä–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä: #}
    {# <link rel="icon" type="image/png" sizes="32x32" href="{% static 'path/to/favicon-32x32.png' %}"> #}
    {# <link rel="icon" type="image/png" sizes="16x16" href="{% static 'path/to/favicon-16x16.png' %}"> #}
    {# <link rel="manifest" href="{% static 'path/to/site.webmanifest' %}"> #}
    {# <link rel="mask-icon" href="{% static 'path/to/safari-pinned-tab.svg' %}" color="#5bbad5"> #}

    <!-- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ CSS —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è FOUC -->
    <link rel="stylesheet" href="{% static 'blog/css/global.css' %}">
    <link rel="stylesheet" href="{% static 'blog/css/header-spacing.css' %}">
    
    <!-- Preload Font Awesome —à—Ä–∏—Ñ—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
    <link rel="preload" href="{% static 'blog/webfonts/fa-solid-900.woff2' %}" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{% static 'blog/webfonts/fa-brands-400.woff2' %}" as="font" type="font/woff2" crossorigin>
    
    <!-- Font Awesome CSS –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ -->
    <!-- –£–±—Ä–∞–Ω JS —Ñ–∞–π–ª font-awesome.min.js (536 –ö–ë) - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ CSS –≤–µ—Ä—Å–∏—é -->
    <link rel="stylesheet" href="{% static 'blog/css/font-awesome.min.css' %}" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="{% static 'blog/css/font-awesome.min.css' %}"></noscript>
    
    <!-- –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ CSS –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ -->
    <link rel="stylesheet" href="{% static 'blog/css/animated_auth.css' %}" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="{% static 'blog/css/animated_auth.css' %}"></noscript>
    
    {% block extra_css %}{% endblock %}

    <script type="module" src="{% static 'blog/js/ionicons/ionicons.esm.js' %}" defer></script>
    <script nomodule src="{% static 'blog/js/ionicons/ionicons.js' %}" defer></script>
    
    <!-- –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ –∫–æ–Ω–µ—Ü body –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è render-blocking) -->

    <!-- GSAP –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ —Ñ—É—Ç–µ—Ä–µ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—á–µ–ª—ã -->

    {% block extra_head %}
    {# Chart.js –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–µ –≥–ª–æ–±–∞–ª—å–Ω–æ #}
    {% endblock %}

    <!-- Google Analytics - –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
    {% if GOOGLE_ANALYTICS_PROPERTY_ID %}
        <script>
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('load', function() {
                setTimeout(function() {
                    var script = document.createElement('script');
                    script.async = true;
                    script.src = 'https://www.googletagmanager.com/gtag/js?id={{ GOOGLE_ANALYTICS_PROPERTY_ID }}';
                    document.head.appendChild(script);
                    
                    script.onload = function() {
                        window.dataLayer = window.dataLayer || [];
                        function gtag(){dataLayer.push(arguments);}
                        gtag('js', new Date());
                        gtag('config', '{{ GOOGLE_ANALYTICS_PROPERTY_ID }}');
                        console.log('Google Analytics initialized with ID: {{ GOOGLE_ANALYTICS_PROPERTY_ID }}');
                    };
                }, 3000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            });
        </script>
    {% endif %}

    <!-- Yandex Metrica - –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
    {% if YANDEX_METRICA_ID %}
        <script>
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('load', function() {
                setTimeout(function() {
                    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
                    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
                    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
                    ym('{{ YANDEX_METRICA_ID }}', "init", { clickmap:true, trackLinks:true, accurateTrackBounce:true });
                    console.log('Yandex Metrica initialized with ID: {{ YANDEX_METRICA_ID }}');
                }, 3000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            });
        </script>
    {% endif %}
 

    <!-- Structured Data (JSON-LD) -->
    {% if website_json_ld %}
        <script type="application/ld+json">
            {{ website_json_ld | safe }}
        </script>
    {% endif %}
    
    {% if organization_json_ld %}
        <script type="application/ld+json">
            {{ organization_json_ld | safe }}
        </script>
    {% endif %}
    
    {% if dynamic_seo.article_json_ld %}
        <script type="application/ld+json">
            {{ dynamic_seo.article_json_ld | safe }}
        </script>
    {% endif %}
    
    {% if dynamic_seo.project_json_ld %}
        <script type="application/ld+json">
            {{ dynamic_seo.project_json_ld | safe }}
        </script>
    {% endif %}
    
    {% if webapp_json_ld %}
        <script type="application/ld+json">
            {{ webapp_json_ld | safe }}
        </script>
    {% endif %}
    
    <!-- Structured data for breadcrumbs (BreadcrumbList) -->
    {% if breadcrumbs_json_ld %}
        <script type="application/ld+json">
            {{ breadcrumbs_json_ld | safe }}
        </script>
    {% endif %}




</head>
<body data-authenticated="{% if user.is_authenticated %}true{% else %}false{% endif %}">
<main>
    {% block sidebar %}
    {% include 'accounts/sidebar.html' %}
    {% endblock %}

    <div class="main-content">
        <nav class="navbar">
            <ul class="navbar-list">
                <li class="navbar-item">
                    <a href="{% url 'blog:home' %}" class="navbar-link home-link" title="{% trans 'Home' %}">
                        <i class="fas fa-home"></i>
                        <span class="nav-text">{% trans "Home" %}</span>
                    </a>
                </li>
                <li class="navbar-item"><a href="{% url 'blog:blog' %}" class="navbar-link">{% trans "Posts" %}</a></li>
                <li class="navbar-item"><a href="{% url 'blog:quizes' %}" class="navbar-link">{% trans "Quizzes" %}</a></li>
                <li class="navbar-item"><a href="{% url 'donation:donation_page' %}" class="navbar-link">{% trans "Donate" %}</a></li>
                {% if user.is_authenticated %}
                <li class="navbar-item"><a href="{% url 'accounts:user-list' %}" class="navbar-link">{% trans "Users" %}</a></li>
                <li class="navbar-item"><a href="{% url 'accounts:profile' %}" class="navbar-link">{% trans "Profile" %}</a></li>
                {% else %}
                <li class="navbar-item"><a href="#" id="login-link" class="navbar-link">{% trans "Login" %}</a></li>
                {% endif %}
                <!-- –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞ -->
                <li class="nav-item">
                    <div class="language-switcher-globe">
                        <div class="globe-icon" id="globe-toggle">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="language-dropdown" id="language-dropdown">
                            <button type="button" class="language-option {% if LANGUAGE_CODE == 'en' %}active{% endif %}"
                                    onclick="switchLanguage('en')" data-lang="en">EN</button>
                            <button type="button" class="language-option {% if LANGUAGE_CODE == 'ru' %}active{% endif %}"
                                    onclick="switchLanguage('ru')" data-lang="ru">RU</button>
                        </div>

                        <!-- –°–∫—Ä—ã—Ç–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                        <form id="hidden-language-form" action="{% url 'custom_set_language' %}" method="post" style="display: none;">
                            {% csrf_token %}
                            <input type="hidden" name="language" id="selected-language">
                        </form>
                    </div>
                </li>
            </ul>
        </nav>

        {% block breadcrumbs %}
        {% endblock %}

        {% block content %}{% endblock %}
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è 3D –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—á–µ–ª—ã -->
    <div id="bee-container"></div>
</main>

{% if not user.is_authenticated %}
<div id="login-modal" class="auth-modal">
    <div class="square">
        <i style="--clr:#00ff0a;"></i>
        <i style="--clr:#ff0057;"></i>
        <i style="--clr:#fffd44;"></i>
        <div class="login">
            <span class="close-btn">√ó</span>
            <h2>Login</h2>
            <form method="post" action="{% url 'accounts:login_ajax' %}" class="login-form">
                {% csrf_token %}
                <div class="inputBx">
                    <input type="text" name="username" placeholder="Username" required>
                </div>
                <div class="inputBx password-group">
                    <input type="password" name="password" id="password" placeholder="Password" required>
                    <button type="button" class="password-toggle" title="Reveal Password" aria-pressed="false">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <mask id="eye-open">
                                    <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12V20H12H1V12Z" fill="#D9D9D9"
                                          stroke="black" stroke-width="1.5" stroke-linejoin="round"/>
                                </mask>
                                <mask id="eye-closed">
                                    <path d="M1 12C1 12 5 20 12 20C19 20 23 12 23 12V20H12H1V12Z" fill="#D9D9D9"/>
                                </mask>
                            </defs>
                            <path class="lid lid--upper" d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12" stroke="currentColor"
                                  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path class="lid lid--lower" d="M1 12C1 12 5 20 12 20C19 20 23 12 23 12"
                                  stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                  stroke-linejoin="round"/>
                            <g mask="url(#eye-open)">
                                <g class="eye">
                                    <circle cy="12" cx="12" r="4" fill="currentColor"/>
                                    <circle cy="11" cx="13" r="1" fill="black"/>
                                </g>
                            </g>
                        </svg>
                        <span class="sr-only">Reveal</span>
                    </button>
                </div>
                <div class="error-message" style="color: red;"></div>
                <div class="inputBx">
                    <input type="submit" value="Login">
                </div>
                
                <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
                <div class="auth-divider">
                    <span>{% trans "–∏–ª–∏" %}</span>
                </div>
                
                <!-- Telegram Login Widget -->
                <div class="inputBx" style="display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 15px;">
                    <!-- –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –î–û –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞ -->
                    <script>
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –î–û –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞ Telegram
                        // –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ - —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                        function handleTelegramAuth(user) {
                            console.log('üîê ============================================');
                            console.log('üîê Telegram auth callback –≤—ã–∑–≤–∞–Ω –ü–†–Ø–ú–´–ú –í–´–ó–û–í–û–ú!');
                            console.log('üîê ============================================');
                            console.log('üì¶ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', user);
                            console.log('üì¶ –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:', typeof user);
                            console.log('üì¶ –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', JSON.stringify(user, null, 2));
                            console.log('üì¶ –í—ã–∑–≤–∞–Ω–æ –∏–∑:', new Error().stack);
                            console.log('üì¶ –†–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞:', navigator.cookieEnabled ? '–û–±—ã—á–Ω—ã–π' : '–ò–Ω–∫–æ–≥–Ω–∏—Ç–æ/–ü—Ä–∏–≤–∞—Ç–Ω—ã–π');
                            console.log('üì¶ User Agent:', navigator.userAgent);
                            
                            if (!user || !user.id) {
                                console.error('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', user);
                                alert('–û—à–∏–±–∫–∞: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                                return;
                            }
                            
                            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                                             document.cookie.match(/csrftoken=([^;]+)/)?.[1] || '';
                            
                            console.log('üì° –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä: /api/social-auth/telegram/auth/');
                            
                            fetch('/api/social-auth/telegram/auth/', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken
                                },
                                body: JSON.stringify(user),
                                credentials: 'include'
                            })
                            .then(async response => {
                                console.log('üì• –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status, response.statusText);
                                
                                if (!response.ok) {
                                    const errorText = await response.text().catch(() => '');
                                    console.error('‚ùå –û—à–∏–±–∫–∞ HTTP:', response.status, errorText);
                                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                                }
                                
                                try {
                                    const contentType = response.headers.get('content-type');
                                    if (contentType && contentType.includes('application/json')) {
                                        return await response.json();
                                    } else {
                                        const text = await response.text();
                                        return JSON.parse(text);
                                    }
                                } catch (parseError) {
                                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', parseError);
                                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                                }
                            })
                            .then(data => {
                                console.log('‚úÖ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
                                if (data && data.success) {
                                    console.log('üéâ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É...');
                                    const loginModal = document.getElementById('login-modal');
                                    if (loginModal && loginModal.classList.contains('active')) {
                                        loginModal.classList.remove('active');
                                    }
                                    window.location.reload();
                                } else {
                                    console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                                    // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert –¥–ª—è –º–∏–º–æ–ª–µ—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫
                                    if (data?.error && !data.error.includes('—É–∂–µ')) {
                                        console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', data.error);
                                    }
                                }
                            })
                            .catch(error => {
                                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä:', error);
                                // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert –¥–ª—è –º–∏–º–æ–ª–µ—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫
                                console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞:', error.message);
                            });
                        }
                        
                        // –Ø–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤ window –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                        // Telegram –≤–∏–¥–∂–µ—Ç –º–æ–∂–µ—Ç –∏—Å–∫–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ window –æ–±—ä–µ–∫—Ç–µ
                        window.handleTelegramAuth = handleTelegramAuth;
                        window.onTelegramAuth = handleTelegramAuth; // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∏–º—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ iframe (–µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ iframe)
        try {
            if (window.parent && window.parent !== window && typeof window.parent.handleTelegramAuth === 'undefined') {
                window.parent.handleTelegramAuth = handleTelegramAuth;
                window.parent.onTelegramAuth = handleTelegramAuth;
            }
            if (window.top && window.top !== window && typeof window.top.handleTelegramAuth === 'undefined') {
                window.top.handleTelegramAuth = handleTelegramAuth;
                window.top.onTelegramAuth = handleTelegramAuth;
            }
        } catch (e) {
            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ CORS
            console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ parent/top (CORS):', e.message);
                        }
                        
                        console.log('‚úÖ –§—É–Ω–∫—Ü–∏—è handleTelegramAuth –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ:', typeof handleTelegramAuth);
                        console.log('‚úÖ window.handleTelegramAuth:', typeof window.handleTelegramAuth);
                        console.log('‚úÖ window.onTelegramAuth:', typeof window.onTelegramAuth);
                        
                        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–∞–∂–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞
                        // Telegram –≤–∏–¥–∂–µ—Ç –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
                        setTimeout(function() {
                            if (typeof window.handleTelegramAuth !== 'function') {
                                console.error('‚ùå –§—É–Ω–∫—Ü–∏—è handleTelegramAuth –ø–æ—Ç–µ—Ä—è–Ω–∞! –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º...');
                                window.handleTelegramAuth = handleTelegramAuth;
                                window.onTelegramAuth = handleTelegramAuth;
                            }
                        }, 2000);
                        
                        // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                        // –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ callback —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–æ–≥–¥–∞ –≤–∏–¥–∂–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è
                        document.addEventListener('DOMContentLoaded', function() {
            const telegramWidgetElement = document.querySelector('script[data-telegram-login]');
            const telegramWidgetIframe = document.querySelector('iframe[src*="oauth.telegram.org"]');
            if (!telegramWidgetElement && !telegramWidgetIframe) {
                console.log('‚ÑπÔ∏è Telegram iframe –≤–∏–¥–∂–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω (–∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–Ω–æ–ø–∫—É —Å redirect). –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.');
                return;
            }
            
                            const loginModal = document.getElementById('login-modal');
                            if (loginModal) {
                                // –ò—Å–ø–æ–ª—å–∑—É–µ–º MutationObserver –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–ª–∞—Å—Å–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                                const observer = new MutationObserver(function(mutations) {
                                    mutations.forEach(function(mutation) {
                                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                                            const isActive = loginModal.classList.contains('active');
                                            if (isActive) {
                                                console.log('üîì –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ, –ø—Ä–æ–≤–µ—Ä—è–µ–º Telegram –≤–∏–¥–∂–µ—Ç...');
                                                
                                                // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞
                                                if (typeof window.handleTelegramAuth !== 'function') {
                                                    console.error('‚ùå –§—É–Ω–∫—Ü–∏—è handleTelegramAuth –Ω–µ –Ω–∞–π–¥–µ–Ω–∞! –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º...');
                                                    window.handleTelegramAuth = handleTelegramAuth;
                                                    window.onTelegramAuth = handleTelegramAuth;
                                                }
                                                
                                                // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∏–¥–∂–µ—Ç –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                                                setTimeout(function() {
                                                    const widgetIframe = document.querySelector('iframe[src*="oauth.telegram.org"]');
                                                    if (widgetIframe && window.Telegram && window.Telegram.LoginWidget) {
                                                        console.log('üîÑ –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram –≤–∏–¥–∂–µ—Ç–∞...');
                                                        window.Telegram.LoginWidget.dataOnauth = handleTelegramAuth;
                                                        if (window.Telegram.LoginWidget.reload) {
                                                            window.Telegram.LoginWidget.reload();
                                                        }
                                                    }
                                                }, 500);
                                            }
                                        }
                                    });
                                });
                                
                                observer.observe(loginModal, {
                                    attributes: true,
                                    attributeFilter: ['class']
                                });
                                
                                console.log('‚úÖ –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –∑–∞ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                            }
                        });
                    </script>
                    
                    <!-- –ö–ù–û–ü–ö–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò –ß–ï–†–ï–ó –°–û–¶–ò–ê–õ–¨–ù–´–ï –°–ï–¢–ò -->
                    <!-- –í–º–µ—Å—Ç–æ –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –≤–∏–¥–∂–µ—Ç–∞ iframe –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º—ã–µ –∫–Ω–æ–ø–∫–∏ —Å redirect -->
                    <!-- –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–µ–µ, —Ç–∞–∫ –∫–∞–∫ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ iframe -->
                    <div style="text-align: center; margin: 20px 0; display: flex; flex-direction: column; gap: 15px; align-items: center;">
                        <!-- –ö–Ω–æ–ø–∫–∞ Telegram -->
                        <a href="{% url 'social_auth:telegram_oauth_redirect' %}" 
                           class="telegram-auth-button"
                           style="display: inline-flex; align-items: center; justify-content: center; gap: 10px; padding: 12px 24px; background: #0088cc; color: white; text-decoration: none; border-radius: 8px; font-size: 16px; font-weight: 500; transition: background 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); width: 100%; max-width: 300px;"
                           onmouseover="this.style.background='#0077b5'"
                           onmouseout="this.style.background='#0088cc'">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="flex-shrink: 0;">
                                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.174 1.858-.924 6.365-1.305 8.443-.152.84-.45 1.12-.74 1.147-.63.056-1.108-.416-1.718-.816-.952-.64-1.49-1.038-2.414-1.663-1.091-.69-.384-1.07.238-1.69.164-.163 2.99-2.744 3.04-2.976.007-.03.014-.15-.056-.212-.07-.062-.173-.041-.248-.024-.106.024-1.794 1.14-5.063 3.345-.48.33-.914.49-1.302.482-.428-.01-1.25-.241-1.86-.44-.752-.245-1.35-.375-1.297-.79.027-.216.325-.437.895-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635.099-.002.321.024.465.14.118.095.151.223.167.312.016.09.036.295.02.455z"/>
                            </svg>
                            <span>{% trans "Login with Telegram" %}</span>
                        </a>
                        
                        <!-- –ö–Ω–æ–ø–∫–∞ GitHub -->
                        <a href="{% url 'social_auth:github_oauth_redirect' %}" 
                           class="github-auth-button"
                           style="display: inline-flex; align-items: center; justify-content: center; gap: 10px; padding: 12px 24px; background: #24292e; color: white; text-decoration: none; border-radius: 8px; font-size: 16px; font-weight: 500; transition: background 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); width: 100%; max-width: 300px;"
                           onmouseover="this.style.background='#171a1d'"
                           onmouseout="this.style.background='#24292e'">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="flex-shrink: 0;">
                                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                            </svg>
                            <span>{% trans "Login with GitHub" %}</span>
                        </a>
                    </div>
                    <p style="text-align: center; color: #666; font-size: 12px; margin-top: 10px;">
                        {% trans "Click to authorize via Telegram or GitHub" %}
                    </p>
                    
                    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ -->
                    <script>
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                        window.addEventListener('load', function() {
                            setTimeout(function() {
                                const widgetScript = document.querySelector('script[data-telegram-login]') || document.querySelector('script[src*="telegram-widget.js"]');
                                const widgetIframe = document.querySelector('iframe[src*="oauth.telegram.org"]');
                                
                                if (!widgetScript && !widgetIframe) {
                                    console.log('‚ÑπÔ∏è Telegram iframe –≤–∏–¥–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä—è–º–∞—è –∫–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏). –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞.');
                                    return;
                                }
                                
                                console.log('üîç –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Telegram –≤–∏–¥–∂–µ—Ç–∞:');
                                console.log('  - window.handleTelegramAuth:', typeof window.handleTelegramAuth);
                                console.log('  - window.Telegram:', typeof window.Telegram);
                                console.log('  - window.Telegram.LoginWidget:', window.Telegram && typeof window.Telegram.LoginWidget);
                                
                                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–æ–≤—ã–π API
                                if (window.Telegram && window.Telegram.LoginWidget && window.handleTelegramAuth) {
                                    window.Telegram.LoginWidget.dataOnauth = window.handleTelegramAuth;
                                    console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è window.Telegram.LoginWidget');
                                }
                                
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º iframe –≤–∏–¥–∂–µ—Ç–∞
                                if (widgetIframe) {
                                    console.log('‚úÖ Iframe –≤–∏–¥–∂–µ—Ç–∞ –Ω–∞–π–¥–µ–Ω:', widgetIframe.src);
                                } else {
                                    console.error('‚ùå Iframe –≤–∏–¥–∂–µ—Ç–∞ –ù–ï –Ω–∞–π–¥–µ–Ω! –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:');
                                    console.error('  1. –î–æ–º–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ BotFather –¥–ª—è –±–æ—Ç–∞ {{ TELEGRAM_BOT_USERNAME }}');
                                    console.error('  2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ @BotFather: /setdomain');
                                    console.error('  3. –£–∫–∞–∂–∏—Ç–µ –¥–æ–º–µ–Ω: ' + window.location.hostname);
                                }
                            }, 1000);
                        });
                    </script>
                    
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS –µ—Å–ª–∏ DEBUG=True) -->
                    <div id="telegram-mock-auth-container" style="text-align: center; margin-top: 10px; display: none;">
                        <a href="{% url 'social_auth:telegram_auth_api' %}?mock=true" 
                           class="telegram-mock-auth-btn"
                           style="display: inline-block; padding: 10px 20px; background: #ff9800; color: white; text-decoration: none; border-radius: 4px; font-size: 14px; transition: background 0.3s;"
                           title="–¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏">
                            üß™ –¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–ª–æ–∫–∞–ª—å–Ω–æ)
                        </a>
                    </div>
                    
                    {% if debug or DEBUG %}
                    <!-- Fallback: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –µ—Å–ª–∏ debug –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —à–∞–±–ª–æ–Ω–µ -->
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            const container = document.getElementById('telegram-mock-auth-container');
                            if (container) {
                                container.style.display = 'block';
                            }
                        });
                    </script>
                    {% endif %}
                </div>
                
                <div class="links">
                    <a href="#" id="to-forgot">{% trans "Forgot Password?" %}</a>
                    <a href="#" id="to-register">{% trans "Signup" %}</a>
                </div>
            </form>
        </div>
    </div>
</div>
<div id="register-modal" class="auth-modal">
    <div class="square">
        <i style="--clr:#00ff0a;"></i>
        <i style="--clr:#ff0057;"></i>
        <i style="--clr:#fffd44;"></i>
        <div class="login register">
            <span class="close-btn">√ó</span>
            <h2>Register</h2>
            {% if request.GET.error %}
                <div class="error-message">
                    <p>{{ request.GET.error|safe }}</p>
                </div>
            {% endif %}
            <form method="post" action="{% url 'accounts:register' %}">
                {% csrf_token %}
                <div class="inputBx">
                    <input type="text" name="username" placeholder="Username" required>
                </div>
                <div class="inputBx">
                    <input type="email" name="email" placeholder="Email" required>
                </div>
                <div class="inputBx">
                    <input type="password" name="password" placeholder="Password" required>
                </div>
                <div class="inputBx">
                    <input type="password" name="password_confirm" placeholder="Confirm Password" required>
                </div>
                <div class="inputBx">
                    <input type="submit" value="Register">
                </div>
                <div class="links">
                    <a href="#" id="to-login">Already have an account? Login</a>
                </div>
            </form>
        </div>
    </div>
</div>

<div id="forgot-modal" class="auth-modal">
    <div class="square">
        <i style="--clr:#00ff0a;"></i>
        <i style="--clr:#ff0057;"></i>
        <i style="--clr:#fffd44;"></i>
        <div class="login forgot">
            <span class="close-btn">&times;</span>
            <h2>{% trans "Forgot Password?" %}</h2>
            <p>{% trans "Enter your email address below and we'll send you a link to reset your password." %}</p>
            <form method="post" action="{% url 'accounts:password_reset' %}">
                {% csrf_token %}
                <div class="inputBx">
                    <input type="email" name="email" required placeholder="{% trans 'Enter your email' %}">
                </div>
                <div class="inputBx">
                    <input type="submit" value="{% trans 'Send Reset Link' %}">
                </div>
                <div class="links">
                    <a href="#" id="back-to-login">{% trans "Back to Login" %}</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}

<script defer src="{% static 'blog/js/main.js' %}"></script>
<script>
    window.loginUrl = "{% url 'accounts:login' %}";
</script>
<script defer src="{% static 'blog/js/auth_modal.js' %}"></script>
<!-- Password animation –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ GSAP (—Å–º. –±–ª–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ GSAP –Ω–∏–∂–µ) -->
<!-- Telegram Auth -->
<!-- <script defer src="{% static 'social_auth/js/telegram-auth.js' %}"></script> -->

<script>
    document.addEventListener('DOMContentLoaded', function () {
        console.log('üöÄ DOMContentLoaded —Å—Ä–∞–±–æ—Ç–∞–ª');
        const urlParams = new URLSearchParams(window.location.search);
        
        const authMessages = {
            registrationSuccess: "{% trans 'Registration successful! Welcome!' %}",
            githubAuthSuccess: "{% trans 'GitHub login successful!' %}",
            telegramAuthSuccess: "{% trans 'Telegram login successful!' %}",
            telegramAuthFailure: "{% trans 'Telegram authorization failed' %}",
            authErrorDefault: "{% trans 'Authentication error' %}"
        };

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        if (urlParams.has('registration_success')) {
            const notification = document.createElement('div');
            notification.className = 'message-notification success';
            notification.textContent = authMessages.registrationSuccess;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ GitHub
        if (urlParams.has('github_auth_success')) {
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ –µ—Å–ª–∏ –æ–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
            const loginModal = document.getElementById('login-modal');
            if (loginModal && loginModal.classList.contains('active')) {
                loginModal.classList.remove('active');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.className = 'message-notification success';
            notification.textContent = authMessages.githubAuthSuccess;
            document.body.appendChild(notification);
            
            // –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É - —Å–µ—Å—Å–∏—è —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
            // –≠—Ç–æ –æ–±–Ω–æ–≤–∏—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            setTimeout(() => {
                notification.remove();
                // –£–¥–∞–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä github_auth_success –∏–∑ URL –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
                const url = new URL(window.location);
                url.searchParams.delete('github_auth_success');
                window.location.href = url.pathname + url.search;
            }, 1500);
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram
        if (urlParams.has('telegram_auth_success')) {
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ –µ—Å–ª–∏ –æ–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
            const loginModal = document.getElementById('login-modal');
            if (loginModal && loginModal.classList.contains('active')) {
                loginModal.classList.remove('active');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            const notification = document.createElement('div');
            notification.className = 'message-notification success';
            notification.textContent = authMessages.telegramAuthSuccess;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            setTimeout(() => {
                window.location.href = window.location.pathname;
            }, 1500);
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –æ—à–∏–±–æ–∫
        console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã...');
        console.log('URL params:', urlParams.toString());
        console.log('open_register:', urlParams.has('open_register'));
        console.log('error:', urlParams.has('error'));
        if (urlParams.has('error')) {
            const errorMessage = urlParams.get('error');
            const notification = document.createElement('div');
            notification.className = 'message-notification error';
            notification.textContent = errorMessage
                ? decodeURIComponent(errorMessage)
                : authMessages.authErrorDefault;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }
        
        // –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Telegram
        // Telegram –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:
        // 1. –í query –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö: ?id=...&hash=...
        // 2. –í hash fragment: #tgAuthResult=base64_json (–Ω–æ–≤—ã–π –º–µ—Ç–æ–¥)
        
        let telegramData = null;
        
        // –°–ø–æ—Å–æ–± 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º hash fragment #tgAuthResult=...
        const hash = window.location.hash;
        if (hash && hash.startsWith('#tgAuthResult=')) {
            console.log('üîê ============================================');
            console.log('üîê –û–ë–ù–ê–†–£–ñ–ï–ù–´ –î–ê–ù–ù–´–ï –û–¢ TELEGRAM –í HASH FRAGMENT!');
            console.log('üîê ============================================');
            
            try {
                const base64Data = hash.substring('#tgAuthResult='.length);
                console.log('  - Base64 –¥–∞–Ω–Ω—ã–µ:', base64Data.substring(0, 100) + '...');
                
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º base64
                const decodedData = atob(base64Data);
                console.log('  - –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', decodedData.substring(0, 200) + '...');
                
                // –ü–∞—Ä—Å–∏–º JSON
                telegramData = JSON.parse(decodedData);
                console.log('  - –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', telegramData);
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (id –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º)
                if (telegramData.id) {
                    telegramData.id = parseInt(telegramData.id);
                }
                if (telegramData.auth_date) {
                    telegramData.auth_date = parseInt(telegramData.auth_date);
                }
                
                console.log('  - –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', telegramData);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ hash fragment:', error);
                telegramData = null;
            }
        }
        
        // –°–ø–æ—Å–æ–± 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥)
        if (!telegramData) {
            const telegramId = urlParams.get('id');
            const telegramHash = urlParams.get('hash');
            
            if (telegramId && telegramHash) {
                console.log('üîê ============================================');
                console.log('üîê –û–ë–ù–ê–†–£–ñ–ï–ù–´ –î–ê–ù–ù–´–ï –û–¢ TELEGRAM –í URL –ü–ê–†–ê–ú–ï–¢–†–ê–•!');
                console.log('üîê ============================================');
                console.log('  - ID:', telegramId);
                console.log('  - Hash:', telegramHash);
                console.log('  - Auth Date:', urlParams.get('auth_date'));
                console.log('  - First Name:', urlParams.get('first_name'));
                console.log('  - Username:', urlParams.get('username'));
                
                // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç Telegram
                telegramData = {
                    id: parseInt(telegramId),
                    hash: telegramHash,
                    auth_date: urlParams.get('auth_date') ? parseInt(urlParams.get('auth_date')) : null,
                    first_name: urlParams.get('first_name') || '',
                    last_name: urlParams.get('last_name') || '',
                    username: urlParams.get('username') || '',
                    photo_url: urlParams.get('photo_url') || ''
                };
                
                console.log('  - –°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', telegramData);
            }
        }
        
        // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ –¥–∞–Ω–Ω—ã–µ –æ—Ç Telegram, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        if (telegramData && telegramData.id && telegramData.hash) {
            console.log('  - –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...');
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                             document.cookie.match(/csrftoken=([^;]+)/)?.[1] || '';
            
            fetch('/api/social-auth/telegram/auth/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify(telegramData),
                credentials: 'include'
            })
            .then(async response => {
                console.log('üì• –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status, response.statusText);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
                if (!response.ok) {
                    const errorText = await response.text().catch(() => '');
                    console.error('‚ùå –û—à–∏–±–∫–∞ HTTP:', response.status, errorText);
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON
                try {
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        return await response.json();
                    } else {
                        const text = await response.text();
                        console.warn('‚ö†Ô∏è –û—Ç–≤–µ—Ç –Ω–µ JSON, –ø—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å:', text);
                        return JSON.parse(text);
                    }
                } catch (parseError) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', parseError);
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                }
            })
            .then(data => {
                console.log('‚úÖ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
                if (data && data.success) {
                    console.log('üéâ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É...');
                    // –û—á–∏—â–∞–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ hash, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    window.history.replaceState({}, document.title, window.location.pathname + window.location.search);
                    setTimeout(function() {
                        window.location.reload();
                    }, 500);
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                    // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert –¥–ª—è –º–∏–º–æ–ª–µ—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫, —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É–µ–º
                    if (data?.error && !data.error.includes('—É–∂–µ')) {
                        console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', data.error);
                    }
                }
            })
            .catch(error => {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä:', error);
                // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert –¥–ª—è –º–∏–º–æ–ª–µ—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫, —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É–µ–º
                console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞:', error.message);
            });
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–ª—å–Ω–µ–π—à—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ open_register
            return;
        }
        
        if (urlParams.has('open_register')) {
            console.log('üîç –ù–∞–π–¥–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä open_register');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
            setTimeout(() => {
                const registerModal = document.getElementById('register-modal');
                console.log('üìã –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', registerModal);
                
                if (registerModal) {
                    console.log('‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
                    registerModal.classList.add('active');
                    console.log('üéØ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ');
                } else {
                    console.log('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                    console.log('üîç –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å id –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:');
                    document.querySelectorAll('[id]').forEach(el => {
                        console.log('  -', el.id, ':', el.tagName);
                    });
                }
            }, 100);
        } else {
            console.log('‚ùå –ü–∞—Ä–∞–º–µ—Ç—Ä open_register –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
    });
</script>
<script>
    // Globe Language Switcher JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        const globeToggle = document.getElementById('globe-toggle');
        const languageDropdown = document.getElementById('language-dropdown');
        const languageSwitcherGlobe = document.querySelector('.language-switcher-globe');

        if (globeToggle && languageDropdown) {
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ dropdown –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –≥–ª–æ–±—É—Å
            globeToggle.addEventListener('click', function(e) {
                e.stopPropagation();

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –º–µ—Å—Ç–æ
                adjustDropdownPosition();

                languageDropdown.classList.toggle('active');
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –Ω–∞ –∫–Ω–æ–ø–∫–∏ —è–∑—ã–∫–∞ (fallback)
            const languageButtons = document.querySelectorAll('.language-option');
            languageButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    const lang = this.getAttribute('data-lang');
                    if (lang) {
                        // –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
                        switchLanguage(lang);
                    }
                });
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ dropdown –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏
            document.addEventListener('click', function(e) {
                if (!languageSwitcherGlobe.contains(e.target)) {
                    languageDropdown.classList.remove('active');
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ dropdown –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && languageDropdown.classList.contains('active')) {
                    languageDropdown.classList.remove('active');
                }
            });

            // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', function() {
                if (languageDropdown.classList.contains('active')) {
                    adjustDropdownPosition();
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ–∑–∏—Ü–∏–∏ dropdown
        function adjustDropdownPosition() {
            if (!globeToggle || !languageDropdown) return;

            const rect = globeToggle.getBoundingClientRect();
            const viewportHeight = window.innerHeight;
            const dropdownHeight = 80; // –ü—Ä–∏–º–µ—Ä–Ω–∞—è –≤—ã—Å–æ—Ç–∞ dropdown
            const spaceBelow = viewportHeight - rect.bottom;
            const spaceAbove = rect.top;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–ª–∞—Å—Å—ã
            languageDropdown.classList.remove('show-above', 'show-below');

            // –ï—Å–ª–∏ –º–µ—Å—Ç–∞ —Å–Ω–∏–∑—É –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –Ω–æ —Å–≤–µ—Ä—Ö—É –µ—Å—Ç—å –º–µ—Å—Ç–æ
            if (spaceBelow < dropdownHeight && spaceAbove > dropdownHeight) {
                languageDropdown.classList.add('show-above');
            } else {
                languageDropdown.classList.add('show-below');
            }
        }
    });

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞
    function switchLanguage(lang) {
        const selectedLanguageInput = document.getElementById('selected-language');
        const hiddenForm = document.getElementById('hidden-language-form');
        const languageDropdown = document.getElementById('language-dropdown');

        if (selectedLanguageInput && hiddenForm) {
            selectedLanguageInput.value = lang;
            languageDropdown.classList.remove('active');

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                hiddenForm.submit();
            }, 150);
        } else {
            // Fallback: –ø—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ URL (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ)
            const currentPath = window.location.pathname;
            const pathParts = currentPath.split('/');
            
            // –£–±–∏—Ä–∞–µ–º —è–∑—ã–∫–æ–≤–æ–π –ø—Ä–µ—Ñ–∏–∫—Å –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            if (pathParts.length > 1 && (pathParts[1] === 'en' || pathParts[1] === 'ru')) {
                pathParts.splice(1, 1); // –£–±–∏—Ä–∞–µ–º —è–∑—ã–∫–æ–≤–æ–π –ø—Ä–µ—Ñ–∏–∫—Å
            }
            
            // –°–æ–±–∏—Ä–∞–µ–º –Ω–æ–≤—ã–π –ø—É—Ç—å
            const newPath = `/${lang}${pathParts.join('/')}`;
            window.location.href = newPath;
        }
    }
</script>
<script>
    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∞–π–¥–±–∞—Ä–∞
    document.addEventListener('DOMContentLoaded', function() {
        const sidebar = document.querySelector('.sidebar');
        const mainContent = document.querySelector('.main-content');

        if (sidebar) {
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            function isMobileOrTablet() {
                return window.innerWidth <= 1024; // –ü–ª–∞–Ω—à–µ—Ç—ã –∏ –º–æ–±–∏–ª—å–Ω—ã–µ
            }

            // –°–æ–∑–¥–∞–µ–º overlay –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–∞–π–¥–±–∞—Ä–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            const overlay = document.createElement('div');
            overlay.className = 'sidebar-overlay';
            document.body.appendChild(overlay);

            // –ò—â–µ–º –∫–Ω–æ–ø–∫—É-—É–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–∞–π–¥–±–∞—Ä–∞ (–æ–±—ã—á–Ω–æ —ç—Ç–æ –∏–∫–æ–Ω–∫–∞ –º–µ–Ω—é)
            const sidebarToggle = document.querySelector('.sidebar-toggle, .menu-toggle, .hamburger');

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–∞–π–¥–±–∞—Ä–∞
            function openSidebar() {
                sidebar.classList.add('active');
                overlay.classList.add('active');
                document.body.classList.add('sidebar-open');
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–∞–π–¥–±–∞—Ä–∞
            function closeSidebar() {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
                document.body.classList.remove('sidebar-open');
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∞–π–¥–±–∞—Ä–∞
            function toggleSidebar() {
                if (sidebar.classList.contains('active')) {
                    closeSidebar();
                } else {
                    openSidebar();
                }
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ-—É–∫–∞–∑–∞—Ç–µ–ª—é (–µ—Å–ª–∏ –µ—Å—Ç—å)
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (isMobileOrTablet()) {
                        toggleSidebar();
                    }
                });
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —Å–∞–π–¥–±–∞—Ä—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            sidebar.addEventListener('click', function(e) {
                if (isMobileOrTablet()) {
                    // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –ø–æ —Å—Å—ã–ª–∫–µ - –ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–∫
                    if (e.target.tagName === 'A' || e.target.closest('a')) {
                        return; // –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–µ –∏–∑–º–µ–Ω—è—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–∞
                    }

                    e.stopPropagation();

                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ª—é–±—É—é –æ–±–ª–∞—Å—Ç—å (–∫—Ä–æ–º–µ —Å—Å—ã–ª–æ–∫)
                    toggleSidebar();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–∞–π–¥–±–∞—Ä–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ overlay
            overlay.addEventListener('click', function() {
                closeSidebar();
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–∞–π–¥–±–∞—Ä–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && sidebar.classList.contains('active')) {
                    closeSidebar();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–∞–π–¥–±–∞—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø
            window.addEventListener('resize', function() {
                if (!isMobileOrTablet() && sidebar.classList.contains('active')) {
                    closeSidebar();
                }
            });

            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: –µ—Å–ª–∏ –Ω–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –∫–Ω–æ–ø–∫–∏-—É–∫–∞–∑–∞—Ç–µ–ª—è,
            // –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–ª–∏–∫–∞ –ø–æ –æ–±–ª–∞—Å—Ç–∏ —Å–∞–π–¥–±–∞—Ä–∞, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å—Å—ã–ª–∫–æ–π
            // –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏–ª–∏ –ø—É—Å—Ç–æ–π –æ–±–ª–∞—Å—Ç–∏
            const sidebarHeader = sidebar.querySelector('.sidebar-header, .profile-info');
            if (sidebarHeader) {
                sidebarHeader.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (isMobileOrTablet()) {
                        toggleSidebar();
                    }
                });
            }
        }
    });

    // –ò—â–µ–º –∫–Ω–æ–ø–∫—É-—É–∫–∞–∑–∞—Ç–µ–ª—å –ø–æ –∞—Ç—Ä–∏–±—É—Ç—É data-sidebar-btn
    const sidebarButton = document.querySelector('[data-sidebar-btn]');

    if (sidebarButton) {
        sidebarButton.addEventListener('click', function(e) {
            e.stopPropagation();
            if (isMobileOrTablet()) {
                if (sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                    document.body.classList.remove('sidebar-open');
                } else {
                    sidebar.classList.add('active');
                    overlay.classList.add('active');
                    document.body.classList.add('sidebar-open');
                }
            }
        });
    }
</script>
<style>
    .message-notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 10px 20px;
        border-radius: 5px;
        z-index: 1000;
        max-width: 400px;
        word-wrap: break-word;
        font-size: 14px;
        line-height: 1.4;
    }

    .message-notification.success {
        background-color: rgba(46, 204, 113, 0.2);
        color: #2ecc71;
        border: 1px solid #2ecc71;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
    @media (max-width: 768px) {
        .message-notification {
            top: 10px;
            right: 10px;
            left: 10px;
            max-width: none;
            width: auto;
            padding: 12px 16px;
            font-size: 13px;
            max-height: 150px;
            overflow-y: auto;
        }
    }
    
    @media (max-width: 480px) {
        .message-notification {
            top: 10px;
            right: 10px;
            left: 10px;
            padding: 10px 14px;
            font-size: 12px;
            max-height: 120px;
        }
    }
    .home-link {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .home-link i {
        font-size: 1.1em;
        transition: transform 0.2s ease;
    }

    .home-link:hover i {
        transform: scale(1.1);
    }

    /* –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∫–æ–Ω–∫—É –Ω–∞ –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
    .nav-text {
        display: none;
    }

    .home-link {
        justify-content: center;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ 3D –ø—á–µ–ª—ã */
    #bee-container {
        position: fixed;
        width: 500px;
        height: 500px;
        pointer-events: none;
        z-index: 999;
        top: 60%;
        left: 70%;
        transform: translate(-50%, -50%);
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
    }

    #bee-container canvas {
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
    }

    @media (max-width: 580px) {
        #bee-container {
            width: 400px;
            height: 400px;
            left: 30%;
            opacity: 0;
        }
    }

</style>
<!-- –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è 3D –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—á–µ–ª—ã (lazy load –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏) -->
<script>
    // Lazy load —Ç—è–∂–µ–ª—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    // –£–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è ScrollTrigger, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
    window.addEventListener('load', function() {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º GSAP —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è password-animation.js
        setTimeout(function() {
            var gsapScript = document.createElement('script');
            gsapScript.src = '{% static "blog/js/gsap.min.js" %}';
            gsapScript.defer = true;
            document.body.appendChild(gsapScript);
            
            gsapScript.onload = function() {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º password-animation.js –ø–æ—Å–ª–µ GSAP (–Ω—É–∂–µ–Ω –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ª–æ–≥–∏–Ω–∞)
                var passwordAnimationScript = document.createElement('script');
                passwordAnimationScript.src = '{% static "blog/js/password-animation.js" %}';
                passwordAnimationScript.defer = true;
                document.body.appendChild(passwordAnimationScript);
            };
        }, 2000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è GSAP
        
        // ScrollTrigger –∑–∞–≥—Ä—É–∂–∞–µ–º —Å –±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
        setTimeout(function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ GSAP —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
            if (typeof gsap === 'undefined') {
                var gsapScript = document.createElement('script');
                gsapScript.src = '{% static "blog/js/gsap.min.js" %}';
                gsapScript.defer = true;
                document.body.appendChild(gsapScript);
                
                gsapScript.onload = function() {
                    loadScrollTrigger();
                };
            } else {
                loadScrollTrigger();
            }
            
            function loadScrollTrigger() {
                var scrollTriggerScript = document.createElement('script');
                scrollTriggerScript.src = '{% static "blog/js/ScrollTrigger.min.js" %}';
                scrollTriggerScript.defer = true;
                document.body.appendChild(scrollTriggerScript);
                
                scrollTriggerScript.onload = function() {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º bee-scroll.js —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ ScrollTrigger
                    setTimeout(function() {
                        var beeScript = document.createElement('script');
                        beeScript.type = 'module';
                        beeScript.src = '{% static "blog/js/bee-scroll.js" %}';
                        beeScript.defer = true;
                        document.body.appendChild(beeScript);
                    }, 1000); // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è bee-scroll.js
                };
            }
        }, 6000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 6 —Å–µ–∫—É–Ω–¥ –¥–ª—è ScrollTrigger (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
    });
</script>

<!-- Telegram Auth Handler - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ -->
<script>
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ postMessage –æ—Ç iframe –≤–∏–¥–∂–µ—Ç–∞ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç postMessage –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞)
    window.addEventListener('message', function(event) {
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (telegram_auth_success.html)
        // –≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å —Ç–æ–≥–æ –∂–µ origin (quiz-code.com), –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ–≥–æ –ø–µ—Ä–≤—ã–º
        if (event.data && event.data.type === 'TELEGRAM_AUTH_SUCCESS') {
            console.log('‚úÖ ============================================');
            console.log('‚úÖ –ü–û–õ–£–ß–ï–ù–û –°–û–û–ë–©–ï–ù–ò–ï –û–ë –£–°–ü–ï–®–ù–û–ô –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò!');
            console.log('‚úÖ ============================================');
            console.log('  - origin:', event.origin);
            console.log('  - –î–∞–Ω–Ω—ã–µ:', event.data);
            console.log('  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', event.data.user);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            console.log('  - –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É...');
            const loginModal = document.getElementById('login-modal');
            if (loginModal && loginModal.classList.contains('active')) {
                loginModal.classList.remove('active');
            }
            window.location.reload();
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç Telegram OAuth (oauth.telegram.org –∏–ª–∏ telegram.org)
        if (event.origin !== 'https://oauth.telegram.org' && event.origin !== 'https://telegram.org') {
            return;
        }
        
        console.log('üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç Telegram OAuth iframe:');
        console.log('  - origin:', event.origin);
        console.log('  - data:', event.data);
        console.log('  - data type:', typeof event.data);
        console.log('  - full event:', event);
        
        let data = event.data;
        
        // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
        if (typeof data === 'string') {
            try {
                const parsed = JSON.parse(data);
                console.log('  - parsed data:', parsed);
                
                // –ï—Å–ª–∏ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ ready/resize, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
                if (parsed.event && (parsed.event === 'ready' || parsed.event === 'resize')) {
                    console.log('  ‚ÑπÔ∏è –°–æ–±—ã—Ç–∏–µ –≤–∏–¥–∂–µ—Ç–∞:', parsed.event);
            return;
        }
        
                // –ï—Å–ª–∏ —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å—Ç—å id)
                if (parsed.id) {
                    console.log('‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram —á–µ—Ä–µ–∑ postMessage (JSON —Å—Ç—Ä–æ–∫–∞)!');
                    console.log('  - user data:', parsed);
                    data = parsed;
                }
            } catch (e) {
                console.log('  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON:', e);
                // –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –Ω–µ JSON, –Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (data && typeof data === 'string' && data.includes('id')) {
                    console.log('  - –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç—Ä–æ–∫–∏...');
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö (Telegram –≤–∏–¥–∂–µ—Ç –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
        // –î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∫–∞–∫ –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏: id, first_name, last_name, username, photo_url, auth_date, hash
        // –ò–õ–ò –∫–∞–∫ –æ–±—ä–µ–∫—Ç —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º –ø–æ–ª–µ–º user: {user: {id, first_name, ...}}
        if (data && typeof data === 'object') {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ–µ –ø–æ–ª–µ user
            let userData = null;
            if (data.user && typeof data.user === 'object' && data.user.id) {
                console.log('‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ {user: {...}}');
                userData = data.user;
            } else if (data.id && (data.first_name !== undefined || data.username !== undefined || data.auth_date !== undefined)) {
                // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞–ø—Ä—è–º—É—é –∫–∞–∫ –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                console.log('‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram –Ω–∞–ø—Ä—è–º—É—é!');
                userData = data;
            }
            
            if (userData) {
            console.log('‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram —á–µ—Ä–µ–∑ postMessage!');
                console.log('  - user data:', userData);
                console.log('  - user id:', userData.id);
                console.log('  - username:', userData.username);
                console.log('  - first_name:', userData.first_name);
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é handleTelegramAuth –µ—Å–ª–∏ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
            if (typeof window.handleTelegramAuth === 'function') {
                console.log('  - –í—ã–∑—ã–≤–∞–µ–º handleTelegramAuth...');
                    window.handleTelegramAuth(userData);
            } else {
                console.error('‚ùå –§—É–Ω–∫—Ü–∏—è handleTelegramAuth –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
                return;
            }
        }
        
        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ª–æ–≥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        console.log('  ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
        console.log('  - –ü—Ä–æ–≤–µ—Ä–∫–∞: data.id =', data && data.id);
        console.log('  - –ü—Ä–æ–≤–µ—Ä–∫–∞: data.first_name =', data && data.first_name);
        console.log('  - –ü—Ä–æ–≤–µ—Ä–∫–∞: data.username =', data && data.username);
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –≤–∏–¥–∂–µ—Ç–∞ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram –≤–∏–¥–∂–µ—Ç–∞...');
        console.log('üì¶ –†–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞:', navigator.cookieEnabled ? '–û–±—ã—á–Ω—ã–π' : '–ò–Ω–∫–æ–≥–Ω–∏—Ç–æ/–ü—Ä–∏–≤–∞—Ç–Ω—ã–π');
        console.log('üì¶ Cookies –≤–∫–ª—é—á–µ–Ω—ã:', navigator.cookieEnabled);
        console.log('üì¶ LocalStorage –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof(Storage) !== 'undefined' ? '–î–∞' : '–ù–µ—Ç');
        console.log('‚ö†Ô∏è –í–ê–ñ–ù–û: –í —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ iframe!');
        console.log('‚ö†Ô∏è –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ –±—Ä–∞—É–∑–µ—Ä–∞.');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å–∫—Ä–∏–ø—Ç–∞ –≤–∏–¥–∂–µ—Ç–∞
        setTimeout(function() {
            const widgetScript = document.querySelector('script[data-telegram-login]') || document.querySelector('script[src*="telegram-widget.js"]');
            const widgetIframe = document.querySelector('iframe[src*="oauth.telegram.org"]');
            
            if (!widgetScript && !widgetIframe) {
                console.log('‚ÑπÔ∏è Telegram iframe –≤–∏–¥–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å redirect). –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–ø—É—â–µ–Ω—ã.');
                return;
            }
            
            console.log('üìã Telegram –≤–∏–¥–∂–µ—Ç —Å—Ç–∞—Ç—É—Å:');
            console.log('  - –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω:', !!widgetScript);
            console.log('  - Iframe —Å–æ–∑–¥–∞–Ω:', !!widgetIframe);
            console.log('  - window.TelegramLoginWidget:', typeof window.TelegramLoginWidget);
            console.log('  - window.Telegram:', typeof window.Telegram);
            console.log('  - window.Telegram.LoginWidget:', window.Telegram && typeof window.Telegram.LoginWidget);
            console.log('  - handleTelegramAuth –¥–æ—Å—Ç—É–ø–Ω–∞:', typeof window.handleTelegramAuth);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ API –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
            if (window.Telegram && window.Telegram.LoginWidget) {
                console.log('‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è window.Telegram.LoginWidget');
                window.Telegram.LoginWidget.dataOnauth = handleTelegramAuth;
                // –¢–∞–∫–∂–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ window –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
                if (typeof window.handleTelegramAuth === 'function') {
                    window.Telegram.LoginWidget.dataOnauth = window.handleTelegramAuth;
                }
            }
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º scope
            if (typeof handleTelegramAuth === 'function') {
                window.handleTelegramAuth = handleTelegramAuth;
                window.onTelegramAuth = handleTelegramAuth;
                console.log('‚úÖ –§—É–Ω–∫—Ü–∏—è handleTelegramAuth –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º scope');
            } else {
                console.error('‚ùå –§—É–Ω–∫—Ü–∏—è handleTelegramAuth –ù–ï –Ω–∞–π–¥–µ–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤.');
            }
            
            if (!widgetIframe) {
                console.error('‚ùå Telegram –≤–∏–¥–∂–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:');
                console.error('  1. –î–æ–º–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ BotFather –¥–ª—è –±–æ—Ç–∞ {{ TELEGRAM_BOT_USERNAME }}');
                console.error('  2. –î–æ–º–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—É—â–µ–º—É: ' + window.location.hostname);
                console.error('  3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ @BotFather: /setdomain –¥–ª—è –¥–æ–º–µ–Ω–∞ ' + window.location.hostname);
            } else {
                console.log('‚úÖ Telegram –≤–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                console.log('üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:');
                console.log('');
                console.log('üîπ –®–ê–ì 1: –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –≤–∏–¥–∂–µ—Ç—É Telegram (–∫–Ω–æ–ø–∫–∞ "Login with Telegram")');
                console.log('üîπ –®–ê–ì 2: –ü–æ—Å–ª–µ –∫–ª–∏–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:');
                console.log('    - üñ±Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–ª–∏–∫ –≤ –æ–±–ª–∞—Å—Ç–∏ Telegram –≤–∏–¥–∂–µ—Ç–∞');
                console.log('    - ‚úÖ handleTelegramAuth –≤—ã–∑–≤–∞–Ω–∞ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞!');
                console.log('    - üîê Telegram auth callback –≤—ã–∑–≤–∞–Ω –ü–†–Ø–ú–´–ú –í–´–ó–û–í–û–ú!');
                console.log('');
                console.log('‚ö†Ô∏è  –ï—Å–ª–∏ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è:');
                console.log('    1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ @BotFather:');
                console.log('       - –û—Ç–∫—Ä–æ–π—Ç–µ @BotFather –≤ Telegram');
                console.log('       - –í—ã–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞: {{ TELEGRAM_BOT_USERNAME }}');
                console.log('       - –í—ã–ø–æ–ª–Ω–∏—Ç–µ: /setdomain');
                console.log('       - –£–∫–∞–∂–∏—Ç–µ –¥–æ–º–µ–Ω: ' + window.location.hostname);
                console.log('    2. –ï—Å–ª–∏ –¥–æ–º–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –Ω–æ callback –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:');
                console.log('       - –í–∏–¥–∂–µ—Ç –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å redirect –≤–º–µ—Å—Ç–æ callback');
                console.log('       - –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ —Ä–µ–¥–∏—Ä–µ–∫—Ç');
                console.log('');
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫–æ–π –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
                const widgetScript = document.querySelector('script[data-telegram-login]');
                const usesCallback = widgetScript && widgetScript.hasAttribute('data-onauth');
                const usesRedirect = widgetScript && widgetScript.hasAttribute('data-auth-url');
                
                console.log('üìä –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:');
                console.log('   - –î–æ–º–µ–Ω: ' + window.location.hostname);
                console.log('   - –ë–æ—Ç: {{ TELEGRAM_BOT_USERNAME }}');
                if (usesCallback) {
                    console.log('   - –ú–µ—Ç–æ–¥: ‚úÖ CALLBACK (data-onauth) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è callback');
                    console.log('   - –ü—Ä–∏ –∫–ª–∏–∫–µ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è handleTelegramAuth(user)');
                    console.log('   - –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ iframe, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç redirect');
                } else if (usesRedirect) {
                    console.log('   - –ú–µ—Ç–æ–¥: ‚ö†Ô∏è  REDIRECT (data-auth-url) - –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ iframe');
                    console.log('   - –ü—Ä–∏ –∫–ª–∏–∫–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /api/social-auth/telegram/auth/');
                    console.log('   - –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –≤ iframe, –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç');
                } else {
                    console.log('   - –ú–µ—Ç–æ–¥: ‚ö†Ô∏è  –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
                }
                console.log('‚úÖ Iframe –≤–∏–¥–∂–µ—Ç–∞ –Ω–∞–π–¥–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥...');
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ iframe –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
                if (widgetIframe) {
                    // –°–æ–∑–¥–∞–µ–º overlay –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–ª–∏–∫–æ–≤
                    const overlay = document.createElement('div');
                    overlay.style.position = 'absolute';
                    overlay.style.top = widgetIframe.offsetTop + 'px';
                    overlay.style.left = widgetIframe.offsetLeft + 'px';
                    overlay.style.width = widgetIframe.offsetWidth + 'px';
                    overlay.style.height = widgetIframe.offsetHeight + 'px';
                    overlay.style.zIndex = '9999';
                    overlay.style.pointerEvents = 'none';
                    overlay.style.backgroundColor = 'transparent';
                    
                    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∫–ª–∏–∫–∏ –≤ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∂–µ—Ç–∞
                    widgetIframe.parentElement.style.position = 'relative';
                    widgetIframe.parentElement.appendChild(overlay);
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                    widgetIframe.parentElement.addEventListener('click', function(e) {
                        console.log('üñ±Ô∏è ============================================');
                        console.log('üñ±Ô∏è –ö–õ–ò–ö –ù–ê TELEGRAM –í–ò–î–ñ–ï–¢!');
                        console.log('üñ±Ô∏è ============================================');
                        console.log('  - –í—Ä–µ–º—è:', new Date().toISOString());
                        console.log('  - target:', e.target);
                        console.log('  - currentTarget:', e.currentTarget);
                        console.log('  - iframe:', widgetIframe);
                        console.log('  - iframe src:', widgetIframe.src);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
                        if (typeof window.handleTelegramAuth === 'function') {
                            console.log('  - ‚úÖ handleTelegramAuth –¥–æ—Å—Ç—É–ø–Ω–∞');
                        } else {
                            console.error('  - ‚ùå handleTelegramAuth –ù–ï –¥–æ—Å—Ç—É–ø–Ω–∞!');
                        }
                        
                        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ iframe –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞
                        let initialIframeSrc = widgetIframe.src;
                        console.log('  - –ù–∞—á–∞–ª—å–Ω—ã–π URL iframe:', initialIframeSrc);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è URL iframe –∫–∞–∂–¥—ã–µ 100ms –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Å–µ–∫—É–Ω–¥
                        let checkCount = 0;
                        const iframeCheckInterval = setInterval(function() {
                            checkCount++;
                            const currentSrc = widgetIframe.src;
                            if (currentSrc !== initialIframeSrc) {
                                console.log('  - üîÑ URL iframe –∏–∑–º–µ–Ω–∏–ª—Å—è!');
                                console.log('    –°—Ç–∞—Ä—ã–π:', initialIframeSrc);
                                console.log('    –ù–æ–≤—ã–π:', currentSrc);
                                
                                // –ï—Å–ª–∏ —ç—Ç–æ redirect –Ω–∞ –Ω–∞—à endpoint —Å –¥–∞–Ω–Ω—ã–º–∏
                                if (currentSrc.includes('/api/social-auth/telegram/auth/')) {
                                    console.log('  - ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω redirect –Ω–∞ Telegram auth endpoint!');
                                    
                                    // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ URL
                                    try {
                                        const url = new URL(currentSrc);
                                        const params = new URLSearchParams(url.search);
                                        const userData = {};
                                        
                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                                        for (const [key, value] of params.entries()) {
                                            userData[key] = value;
                                        }
                                        
                                        if (userData.id) {
                                            console.log('  - ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–π–¥–µ–Ω—ã –≤ URL iframe!');
                                            console.log('  - user data:', userData);
                                            
                                            // –í—ã–∑—ã–≤–∞–µ–º handleTelegramAuth —Å –¥–∞–Ω–Ω—ã–º–∏
                                            if (typeof window.handleTelegramAuth === 'function') {
                                                console.log('  - –í—ã–∑—ã–≤–∞–µ–º handleTelegramAuth —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ URL...');
                                                window.handleTelegramAuth(userData);
                                            } else {
                                                console.error('  - ‚ùå handleTelegramAuth –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                                            }
                                        } else {
                                            console.log('  - ‚ö†Ô∏è URL —Å–æ–¥–µ—Ä–∂–∏—Ç endpoint, –Ω–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                                            console.log('  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã URL:', Object.fromEntries(params));
                                        }
                                    } catch (e) {
                                        console.error('  - ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ URL iframe:', e);
                                    }
                                }
                                
                                initialIframeSrc = currentSrc;
                            }
                            
                            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –∏–ª–∏ –ø–æ—Å–ª–µ 50 –ø—Ä–æ–≤–µ—Ä–æ–∫
                            if (checkCount >= 50) {
                                clearInterval(iframeCheckInterval);
                                console.log('  - ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π URL iframe');
                            }
                        }, 100);
                    }, true); // –ò—Å–ø–æ–ª—å–∑—É–µ–º capture phase
                }
                
                // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π URL (–¥–ª—è redirect –º–µ—Ç–æ–¥–∞)
                let currentUrl = window.location.href;
                const urlCheckInterval = setInterval(function() {
                    if (window.location.href !== currentUrl) {
                        const oldUrl = currentUrl;
                        currentUrl = window.location.href;
                        console.log('üîÑ –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ URL:');
                        console.log('  - –°—Ç–∞—Ä—ã–π URL:', oldUrl);
                        console.log('  - –ù–æ–≤—ã–π URL:', currentUrl);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º –æ—Ç Telegram
                        if (currentUrl.includes('/api/social-auth/telegram/auth/')) {
                            console.log('‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ Telegram auth endpoint!');
                            console.log('  - –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ URL...');
                            const urlParams = new URLSearchParams(window.location.search);
                            console.log('  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã URL:', Object.fromEntries(urlParams));
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Telegram
                            if (urlParams.has('id')) {
                                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç Telegram –Ω–∞–π–¥–µ–Ω—ã –≤ URL!');
                            } else {
                                console.error('‚ùå –î–∞–Ω–Ω—ã–µ –æ—Ç Telegram –ù–ï –Ω–∞–π–¥–µ–Ω—ã –≤ URL!');
                                console.error('  - –í–æ–∑–º–æ–∂–Ω–æ, –¥–æ–º–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ BotFather');
                                console.error('  - –ò–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ');
                            }
                        }
                    }
                }, 100);
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
                setTimeout(function() {
                    clearInterval(urlCheckInterval);
                }, 30000);
                
                // –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π URL –≤ iframe –≤–∏–¥–∂–µ—Ç–∞ (–µ—Å–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ iframe)
                if (widgetIframe) {
                    let iframeUrl = widgetIframe.src || '';
                    let lastCheckedUrl = iframeUrl;
                    const iframeUrlCheckInterval = setInterval(function() {
                        try {
                            // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å URL –∏–∑ iframe (–º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑-–∑–∞ CORS)
                            const newIframeUrl = widgetIframe.src || '';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ URL
                            if (newIframeUrl !== lastCheckedUrl) {
                                console.log('üîÑ ============================================');
                                console.log('üîÑ –û–ë–ù–ê–†–£–ñ–ï–ù–û –ò–ó–ú–ï–ù–ï–ù–ò–ï URL IFRAME –í–ò–î–ñ–ï–¢–ê!');
                                console.log('üîÑ ============================================');
                                console.log('  - –°—Ç–∞—Ä—ã–π URL iframe:', lastCheckedUrl);
                                console.log('  - –ù–æ–≤—ã–π URL iframe:', newIframeUrl);
                                
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –Ω–æ–≤—ã–π URL –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                                if (newIframeUrl.includes('/api/social-auth/telegram/auth/')) {
                                    console.log('  - ‚úÖ URL —Å–æ–¥–µ—Ä–∂–∏—Ç auth endpoint!');
                                    
                                    // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ URL
                                    try {
                                        const url = new URL(newIframeUrl);
                                        const params = new URLSearchParams(url.search);
                                        const userData = {};
                                        
                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                                        for (const [key, value] of params.entries()) {
                                            userData[key] = value;
                                        }
                                        
                                        if (userData.id) {
                                            console.log('  - ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–π–¥–µ–Ω—ã –≤ URL iframe!');
                                            console.log('  - user data:', userData);
                                            
                                            // –í—ã–∑—ã–≤–∞–µ–º handleTelegramAuth —Å –¥–∞–Ω–Ω—ã–º–∏
                                            if (typeof window.handleTelegramAuth === 'function') {
                                                console.log('  - –í—ã–∑—ã–≤–∞–µ–º handleTelegramAuth —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ URL iframe...');
                                                window.handleTelegramAuth(userData);
                                            } else {
                                                console.error('  - ‚ùå handleTelegramAuth –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                                            }
                                        } else {
                                            console.log('  - ‚ö†Ô∏è URL —Å–æ–¥–µ—Ä–∂–∏—Ç endpoint, –Ω–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                                            console.log('  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã URL:', Object.fromEntries(params));
                            }
                        } catch (e) {
                                        console.error('  - ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ URL iframe:', e);
                                    }
                                } else if (newIframeUrl.includes('return_to') && newIframeUrl.includes('quiz-code.com')) {
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ URL return_to —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ query –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
                                    console.log('  - URL —Å–æ–¥–µ—Ä–∂–∏—Ç return_to, –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
                                    try {
                                        const url = new URL(newIframeUrl);
                                        const params = new URLSearchParams(url.search);
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                                        const userData = {};
                                        let hasUserData = false;
                                        
                                        for (const [key, value] of params.entries()) {
                                            if (key === 'id' || key === 'first_name' || key === 'username' || key === 'auth_date' || key === 'hash') {
                                                userData[key] = value;
                                                if (key === 'id') hasUserData = true;
                                            }
                                        }
                                        
                                        if (hasUserData && userData.id) {
                                            console.log('  - ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–π–¥–µ–Ω—ã –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö URL iframe!');
                                            console.log('  - user data:', userData);
                                            
                                            if (typeof window.handleTelegramAuth === 'function') {
                                                console.log('  - –í—ã–∑—ã–≤–∞–µ–º handleTelegramAuth —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL...');
                                                window.handleTelegramAuth(userData);
                                            }
                                        }
                                    } catch (e) {
                                        console.error('  - ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL iframe:', e);
                                    }
                                }
                                
                                lastCheckedUrl = newIframeUrl;
                            }
                        } catch (e) {
                            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ CORS, –Ω–æ –ª–æ–≥–∏—Ä—É–µ–º –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
                            // console.log('  - ‚ö†Ô∏è CORS –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ URL iframe:', e.message);
                        }
                    }, 100); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 100ms –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
                    
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
                    setTimeout(function() {
                        clearInterval(iframeUrlCheckInterval);
                        console.log('‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π URL iframe');
                    }, 60000);
                }
                
                // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ iframe –∏ —Å–∞–º–æ–º iframe
                const iframeContainer = widgetIframe.parentElement;
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
                if (iframeContainer) {
                    iframeContainer.addEventListener('click', function(e) {
                        console.log('üñ±Ô∏è ============================================');
                        console.log('üñ±Ô∏è –ö–õ–ò–ö –ù–ê –ö–û–ù–¢–ï–ô–ù–ï–†–ï IFRAME –í–ò–î–ñ–ï–¢–ê!');
                        console.log('üñ±Ô∏è ============================================');
                        console.log('  - –í—Ä–µ–º—è:', new Date().toISOString());
                        console.log('  - –¶–µ–ª—å –∫–ª–∏–∫–∞:', e.target);
                        console.log('  - –í–∏–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–¥–µ–ª–∞—Ç—å redirect –Ω–∞ /api/social-auth/telegram/auth/');
                        console.log('  - –ï—Å–ª–∏ redirect –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ BotFather');
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π URL iframe –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                        const initialIframeUrl = widgetIframe.src;
                        console.log('  - –ù–∞—á–∞–ª—å–Ω—ã–π URL iframe:', initialIframeUrl);
                        
                        // –ù–∞—á–∏–Ω–∞–µ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π URL iframe
                        let checkCount = 0;
                        const maxChecks = 50; // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Å–µ–∫—É–Ω–¥ (50 * 100ms)
                        const urlCheckInterval = setInterval(function() {
                            checkCount++;
                            try {
                                const currentSrc = widgetIframe.src;
                                
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ URL
                                if (currentSrc !== initialIframeUrl && currentSrc.includes('/api/social-auth/telegram/auth/')) {
                                    console.log('‚úÖ ============================================');
                                    console.log('‚úÖ REDIRECT –û–ë–ù–ê–†–£–ñ–ï–ù –í IFRAME –ü–û–°–õ–ï –ö–õ–ò–ö–ê!');
                                    console.log('‚úÖ ============================================');
                                    console.log('  - –ù–æ–≤—ã–π URL iframe:', currentSrc);
                                    
                                    // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ URL
                                    try {
                                        const url = new URL(currentSrc);
                                        const params = new URLSearchParams(url.search);
                                        const userData = {};
                                        
                                        for (const [key, value] of params.entries()) {
                                            userData[key] = value;
                                        }
                                        
                                        if (userData.id) {
                                            console.log('  - ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–π–¥–µ–Ω—ã –≤ URL iframe!');
                                            console.log('  - user data:', userData);
                                            
                                            if (typeof window.handleTelegramAuth === 'function') {
                                                console.log('  - –í—ã–∑—ã–≤–∞–µ–º handleTelegramAuth —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ URL iframe...');
                                                window.handleTelegramAuth(userData);
                                } else {
                                                console.error('  - ‚ùå handleTelegramAuth –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                                            }
                                        } else {
                                            console.log('  - ‚ö†Ô∏è URL —Å–æ–¥–µ—Ä–∂–∏—Ç endpoint, –Ω–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                                            console.log('  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã URL:', Object.fromEntries(params));
                                }
                            } catch (e) {
                                        console.error('  - ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ URL iframe:', e);
                                    }
                                    
                                    clearInterval(urlCheckInterval);
                                    return;
                                }
                                
                                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                                if (checkCount >= maxChecks) {
                                    clearInterval(urlCheckInterval);
                                    console.log('  - ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π URL iframe (5 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ—à–ª–æ)');
                                    console.log('  - ‚ùå Redirect –ù–ï –ø—Ä–æ–∏–∑–æ—à–µ–ª –≤ iframe!');
                                    console.log('  - –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:');
                                    console.log('    1. –î–æ–º–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ BotFather –¥–ª—è –±–æ—Ç–∞ mr_proger_bot');
                                    console.log('    2. –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç redirect –∏–∑ iframe');
                                    console.log('    3. –í–∏–¥–∂–µ—Ç –Ω–µ –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å redirect');
                                    console.log('    4. –í–∏–¥–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                                }
                            } catch (e) {
                                console.error('  - –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å URL iframe (CORS):', e.message);
                            }
                        }, 100); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 100ms
                    }, true); // –ò—Å–ø–æ–ª—å–∑—É–µ–º capture phase –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –≤—Å–µ—Ö –∫–ª–∏–∫–æ–≤
                }
                
                // –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∫–ª–∏–∫ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞ iframe
                // (—Ö–æ—Ç—è –æ–±—ã—á–Ω–æ –∫–ª–∏–∫–∏ –Ω–∞ iframe –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏–∑-–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
                widgetIframe.addEventListener('click', function(e) {
                    console.log('üñ±Ô∏è ============================================');
                    console.log('üñ±Ô∏è –ö–õ–ò–ö –ù–ê–ü–†–Ø–ú–£–Æ –ù–ê IFRAME –í–ò–î–ñ–ï–¢–ê!');
                    console.log('üñ±Ô∏è ============================================');
                    console.log('  - –í—Ä–µ–º—è:', new Date().toISOString());
                    console.log('  - –≠—Ç–æ —Å–æ–±—ã—Ç–∏–µ –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ iframe');
                }, true);
                
                // –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∫–ª–∏–∫ –Ω–∞ —Å–∞–º–æ–º iframe
                widgetIframe.addEventListener('load', function() {
                    console.log('üì• ============================================');
                    console.log('üì• IFRAME –í–ò–î–ñ–ï–¢–ê –ó–ê–ì–†–£–ñ–ï–ù/–ü–ï–†–ï–ó–ê–ì–†–£–ñ–ï–ù!');
                    console.log('üì• ============================================');
                    console.log('  - URL iframe:', widgetIframe.src);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ URL –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                    if (widgetIframe.src.includes('/api/social-auth/telegram/auth/')) {
                        console.log('‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω redirect –Ω–∞ auth endpoint –≤ iframe!');
                        
                        // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ URL
                        try {
                            const url = new URL(widgetIframe.src);
                            const params = new URLSearchParams(url.search);
                            const userData = {};
                            
                            for (const [key, value] of params.entries()) {
                                userData[key] = value;
                            }
                            
                            if (userData.id) {
                                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–π–¥–µ–Ω—ã –≤ URL iframe –ø–æ—Å–ª–µ redirect!');
                                console.log('  - user data:', userData);
                                
                                // –í—ã–∑—ã–≤–∞–µ–º handleTelegramAuth —Å –¥–∞–Ω–Ω—ã–º–∏
                                if (typeof window.handleTelegramAuth === 'function') {
                                    console.log('  - –í—ã–∑—ã–≤–∞–µ–º handleTelegramAuth —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ URL iframe...');
                                    window.handleTelegramAuth(userData);
                                } else {
                                    console.error('  - ‚ùå handleTelegramAuth –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                                }
                            } else {
                                console.log('  - ‚ö†Ô∏è URL —Å–æ–¥–µ—Ä–∂–∏—Ç endpoint, –Ω–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                                console.log('  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã URL:', Object.fromEntries(params));
                            }
                        } catch (e) {
                            console.error('  - ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ URL iframe:', e);
                        }
                    } else if (widgetIframe.src.includes('return_to')) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ URL return_to —Å –¥–∞–Ω–Ω—ã–º–∏
                        console.log('  - URL —Å–æ–¥–µ—Ä–∂–∏—Ç return_to, –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
                        try {
                            const url = new URL(widgetIframe.src);
                            const params = new URLSearchParams(url.search);
                            
                            // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä return_to, –ø—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –æ–Ω –¥–∞–Ω–Ω—ã–µ
                            const returnTo = params.get('return_to');
                            if (returnTo && returnTo.includes('/api/social-auth/telegram/auth/')) {
                                console.log('  - return_to —Å–æ–¥–µ—Ä–∂–∏—Ç auth endpoint!');
                                const returnUrl = new URL(returnTo);
                                const returnParams = new URLSearchParams(returnUrl.search);
                                
                                const userData = {};
                                for (const [key, value] of returnParams.entries()) {
                                    userData[key] = value;
                                }
                                
                                if (userData.id) {
                                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–π–¥–µ–Ω—ã –≤ return_to –ø–∞—Ä–∞–º–µ—Ç—Ä–µ!');
                                    console.log('  - user data:', userData);
                                    
                                    if (typeof window.handleTelegramAuth === 'function') {
                                        window.handleTelegramAuth(userData);
                                    }
                                }
                            }
                        } catch (e) {
                            console.error('  - ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ return_to:', e);
                        }
                    }
                });
            }
        }, 3000);
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ API (window.Telegram.LoginWidget)
        if (window.Telegram && window.Telegram.LoginWidget) {
            console.log('‚úÖ –ù–æ–≤—ã–π API Telegram.LoginWidget –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫');
            window.Telegram.LoginWidget.dataOnauth = handleTelegramAuth;
        }
        
        // –¢–∞–∫–∂–µ –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ API (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
    if (window.TelegramLoginWidget) {
            console.log('‚úÖ –°—Ç–∞—Ä—ã–π API TelegramLoginWidget –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫');
        window.TelegramLoginWidget.dataOnauth = handleTelegramAuth;
    }
    
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ç–µ—Å—Ç–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
        const container = document.getElementById('telegram-mock-auth-container');
        if (container) {
            const isLocalhost = window.location.hostname === 'localhost' || 
                               window.location.hostname === '127.0.0.1' ||
                               window.location.hostname.includes('localhost');
            const urlParams = new URLSearchParams(window.location.search);
            const showMock = urlParams.has('show_mock');
            
            if (isLocalhost || showMock) {
                container.style.display = 'block';
            }
        }
    });
    
    // –¢–∞–∫–∂–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–∏–¥–∂–µ—Ç–∞ (–µ—Å–ª–∏ –æ–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
    window.addEventListener('load', function() {
        setTimeout(function() {
            if (window.Telegram && window.Telegram.LoginWidget) {
                console.log('‚úÖ –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ API');
                window.Telegram.LoginWidget.dataOnauth = handleTelegramAuth;
            }
            if (window.TelegramLoginWidget) {
                console.log('‚úÖ –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ API');
                window.TelegramLoginWidget.dataOnauth = handleTelegramAuth;
            }
        }, 1000);
    });
    
    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ—á–µ–Ω—å –ø–æ–∑–¥–Ω–æ)
    let checkCount = 0;
    const checkInterval = setInterval(function() {
        checkCount++;
        if (checkCount > 10) {
            clearInterval(checkInterval);
            return;
        }
        
        if (window.Telegram && window.Telegram.LoginWidget) {
            if (!window.Telegram.LoginWidget.dataOnauth || window.Telegram.LoginWidget.dataOnauth !== handleTelegramAuth) {
                console.log('‚úÖ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ API');
                window.Telegram.LoginWidget.dataOnauth = handleTelegramAuth;
            }
        }
    }, 1000);
</script>

<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
    .telegram-mock-auth-btn:hover {
        background: #f57c00 !important;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .telegram-mock-auth-btn:active {
        transform: translateY(0);
    }
    
    #telegram-mock-auth-container {
        margin-top: 15px;
    }
</style>

{% block scripts %}{% endblock %}

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JavaScript –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –æ—Ç—Å—Ç—É–ø–æ–≤ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ -->
<script src="{% static 'blog/js/header-spacing.js' %}" defer></script>

<!-- –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ —Å—é–¥–∞ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è render-blocking) -->
<script>
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –≤–∏–¥–∂–µ—Ç–∞ Telegram
    window.addEventListener('message', function(event) {
        if (event.data && event.data.type === 'telegram-auth') {
            window.onTelegramAuth(event.data.user);
        }
    });
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    window.onTelegramAuth = function(user) {
        console.log('Telegram auth called with:', user);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º CSRF —Ç–æ–∫–µ–Ω
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
        if (!csrfToken) {
            console.error('CSRF token not found');
            alert('–û—à–∏–±–∫–∞: CSRF —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        fetch('/api/social-auth/telegram/auth/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken.value,
            },
            body: JSON.stringify(user)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('üì¶ Response data:', data);
            if (data.success) {
                console.log('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...');
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ –µ—Å–ª–∏ –æ–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
                const loginModal = document.getElementById('login-modal');
                if (loginModal && loginModal.classList.contains('active')) {
                    loginModal.classList.remove('active');
                }
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                const notification = document.createElement('div');
                notification.className = 'message-notification success';
                notification.textContent = data.message || authMessages.telegramAuthSuccess;
                document.body.appendChild(notification);
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ —É–∫–∞–∑–∞–Ω–Ω—ã–π URL
                setTimeout(() => {
                    if (data.redirect_url) {
                        window.location.href = data.redirect_url;
                    } else {
                        window.location.href = '/';
                    }
                }, 1000);
            } else {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', data.error);
            alert(data.error || authMessages.authErrorDefault);
            }
        })
        .catch(error => {
            console.error('Network error:', error);
            alert(authMessages.telegramAuthFailure + ': ' + error.message);
        });
    };
</script>

</body>
</html>