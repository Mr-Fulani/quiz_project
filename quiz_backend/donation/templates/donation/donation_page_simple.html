{% extends 'blog/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}Donation - Simple Test{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css?family=Raleway:300,400,600" rel="stylesheet">
<style>
body.donation-page {
    margin: 0;
    padding: 20px;
    background-color: #f9f9f9;
    font-family: 'Raleway', sans-serif;
}

.donation-container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.container {
    width: 100%;
    max-width: 400px;
    max-height: 251px;
    height: 54vw;
    padding: 20px;
    margin: 0 auto 30px;
}

.creditcard {
    width: 100%;
    max-width: 400px;
    transform-style: preserve-3d;
    transition: transform 0.6s;
    cursor: pointer;
}

.creditcard .front,
.creditcard .back {
    position: absolute;
    width: 100%;
    max-width: 400px;
    backface-visibility: hidden;
    color: #47525d;
}

.creditcard .back {
    transform: rotateY(180deg);
}

.creditcard.flipped {
    transform: rotateY(180deg);
}

.creditcard svg#cardfront,
.creditcard svg#cardback {
    width: 100%;
    box-shadow: 1px 5px 6px 0px black;
    border-radius: 22px;
}

#svgname { fill: #FFFFFF; font-size: 18px; font-weight: 600; }
#svgnameback { fill: #FFFFFF; font-size: 18px; }
#svgnumber { fill: #FFFFFF; font-size: 18px; }
#svgexpire { fill: #FFFFFF; font-size: 16px; }
#svgsecurity { fill: #000; font-size: 16px; font-weight: bold; }

.form-container {
    display: grid;
    grid-column-gap: 15px;
    grid-row-gap: 20px;
    grid-template-columns: 1fr 1fr;
    grid-template-areas: 
        "name name"
        "cardnumber cardnumber"
        "expiry security";
    max-width: 400px;
    margin: 0 auto 30px;
    color: #707070;
}

.field-container:nth-child(1) { grid-area: name; }
.field-container:nth-child(2) { grid-area: cardnumber; }
.field-container:nth-child(3) { grid-area: expiry; }
.field-container:nth-child(4) { grid-area: security; }

.field-container label {
    display: block;
    padding-bottom: 5px;
    font-size: 13px;
    font-weight: 500;
    color: #555;
}

.field-container input {
    width: 100%;
    padding: 15px;
    font-size: 16px;
    border-radius: 6px;
    border: 2px solid #ddd;
    box-sizing: border-box;
    transition: border-color 0.3s;
}

.field-container input:focus {
    outline: none;
    border-color: #4285f4;
    transform: scale(1.02);
}

#generatecard {
    position: absolute;
    right: 10px;
    top: -25px;
    cursor: pointer;
    font-size: 12px;
    color: #fff;
    padding: 4px 8px;
    background-color: #666;
    border-radius: 4px;
    text-decoration: none;
    z-index: 5;
}

.lightcolor { fill: #999; }
.darkcolor { fill: #666; }

.lightcolor.blue { fill: #0E4595; }
.darkcolor.bluedark { fill: #0E4595; }
.lightcolor.red { fill: #eb001b; }
.darkcolor.reddark { fill: #d32f2f; }
.lightcolor.green { fill: #66bb6a; }
.darkcolor.greendark { fill: #388e3c; }
</style>
{% endblock %}

{% block content %}
<body class="donation-page">
<div class="donation-container">
    <header class="payment-title">
        <h1>{% trans "Simple Card Animation Test" %}</h1>
    </header>

    <div class="container">
        <div class="creditcard" id="creditcard">
            <div class="front">
                <svg version="1.1" id="cardfront" xmlns="http://www.w3.org/2000/svg" 
                    x="0px" y="0px" viewBox="0 0 750 471" xml:space="preserve">
                    <g id="Front">
                        <g id="CardBackground">
                            <path class="lightcolor" d="M40,0h670c22.1,0,40,17.9,40,40v391c0,22.1-17.9,40-40,40H40c-22.1,0-40-17.9-40-40V40
                    C0,17.9,17.9,0,40,0z" />
                        </g>
                        <path class="darkcolor" d="M750,431V193.2c-217.6-57.5-556.4-13.5-750,24.9V431c0,22.1,17.9,40,40,40h670C732.1,471,750,453.1,750,431z" />
                        <text transform="matrix(1 0 0 1 60.106 295.0121)" id="svgnumber">•••• •••• •••• ••••</text>
                        <text transform="matrix(1 0 0 1 54.1064 428.1723)" id="svgname">YOUR NAME</text>
                        <text transform="matrix(1 0 0 1 54.1074 389.8793)" style="fill: #FFFFFF; opacity: 0.7; font-size: 11px;">cardholder name</text>
                        <text transform="matrix(1 0 0 1 543.714 428.1723)" id="svgexpire">01/23</text>
                        <text transform="matrix(1 0 0 1 543.714 389.8793)" style="fill: #FFFFFF; opacity: 0.7; font-size: 11px;">expiry</text>
                        <text transform="matrix(1 0 0 1 479.36 415.0547)" style="fill: #FFFFFF; opacity: 0.7; font-size: 11px;">valid thru</text>
                    </g>
                </svg>
            </div>
            <div class="back">
                <svg version="1.1" id="cardback" xmlns="http://www.w3.org/2000/svg" 
                    x="0px" y="0px" viewBox="0 0 750 471" xml:space="preserve">
                    <g id="Back">
                        <path class="darkcolor" d="M40,0h670c22.1,0,40,17.9,40,40v391c0,22.1-17.9,40-40,40H40c-22.1,0-40-17.9-40-40V40
                C0,17.9,17.9,0,40,0z" />
                        <rect y="61.6" style="fill: #000;" width="750" height="78" />
                        <rect x="42.9" y="198.6" style="fill: #FFF;" width="664.1" height="50" />
                        <text transform="matrix(1 0 0 1 621.999 227.2734)" id="svgsecurity">•••</text>
                        <text transform="matrix(1 0 0 1 518.083 280.0879)" style="fill: #000; font-size: 14px;">security code</text>
                        <text transform="matrix(1 0 0 1 59.5073 228.6099)" id="svgnameback">Your Name</text>
                    </g>
                </svg>
            </div>
        </div>
    </div>

    <div class="form-container">
        <div class="field-container">
            <label for="name">{% trans "Cardholder Name" %}</label>
            <input id="name" maxlength="25" type="text" placeholder="Enter cardholder name">
        </div>
        <div class="field-container" style="position: relative;">
            <label for="cardnumber">{% trans "Card Number" %}</label>
            <span id="generatecard">{% trans "generate random" %}</span>
            <input id="cardnumber" type="text" placeholder="1234 5678 9012 3456">
        </div>
        <div class="field-container">
            <label for="expirationdate">{% trans "Expiration (mm/yy)" %}</label>
            <input id="expirationdate" type="text" placeholder="01/25">
        </div>
        <div class="field-container">
            <label for="securitycode">{% trans "Security Code" %}</label>
            <input id="securitycode" type="text" placeholder="123">
        </div>
    </div>
</div>

<script src="https://unpkg.com/imask"></script>
<script>
console.log('Simple card animation loading...');

// Get DOM elements
const name = document.getElementById('name');
const cardnumber = document.getElementById('cardnumber');
const expirationdate = document.getElementById('expirationdate');
const securitycode = document.getElementById('securitycode');
const generatecard = document.getElementById('generatecard');

// Simple input masks
var cardnumber_mask = new IMask(cardnumber, {
    mask: '0000 0000 0000 0000'
});

var expirationdate_mask = new IMask(expirationdate, {
    mask: 'MM{/}YY',
    groups: {
        YY: new IMask.MaskedPattern.Group.Range([0, 99]),
        MM: new IMask.MaskedPattern.Group.Range([1, 12])
    }
});

var securitycode_mask = new IMask(securitycode, {
    mask: '0000'
});

// Function to detect card type
function detectCardType(number) {
    const cleanNumber = number.replace(/\D/g, '');
    
    if (/^4/.test(cleanNumber)) return 'visa';
    if (/^5[1-5]/.test(cleanNumber)) return 'mastercard';
    if (/^3[47]/.test(cleanNumber)) return 'amex';
    if (/^6011/.test(cleanNumber)) return 'discover';
    
    return 'unknown';
}

// Function to change card colors
function swapColor(color) {
    const lightElements = document.querySelectorAll('.lightcolor');
    const darkElements = document.querySelectorAll('.darkcolor');
    
    // Remove existing color classes
    const colors = ['blue', 'red', 'green', 'yellow', 'purple'];
    colors.forEach(c => {
        lightElements.forEach(el => el.classList.remove(c));
        darkElements.forEach(el => el.classList.remove(c + 'dark'));
    });
    
    // Add new color
    lightElements.forEach(el => el.classList.add(color));
    darkElements.forEach(el => el.classList.add(color + 'dark'));
}

// Update card display
function updateCardDisplay() {
    // Update name
    const svgname = document.getElementById('svgname');
    const svgnameback = document.getElementById('svgnameback');
    const nameValue = name.value || 'YOUR NAME';
    
    if (svgname) svgname.textContent = nameValue.toUpperCase();
    if (svgnameback) svgnameback.textContent = nameValue;
    
    // Update number
    const svgnumber = document.getElementById('svgnumber');
    const numberValue = cardnumber_mask.value || '•••• •••• •••• ••••';
    if (svgnumber) svgnumber.textContent = numberValue;
    
    // Update expiration
    const svgexpire = document.getElementById('svgexpire');
    const expireValue = expirationdate_mask.value || '01/23';
    if (svgexpire) svgexpire.textContent = expireValue;
    
    // Update security code
    const svgsecurity = document.getElementById('svgsecurity');
    const securityValue = securitycode_mask.value || '•••';
    if (svgsecurity) svgsecurity.textContent = securityValue;
    
    // Detect and update card type
    const cardType = detectCardType(cardnumber.value);
    switch(cardType) {
        case 'visa':
            swapColor('blue');
            break;
        case 'mastercard':
            swapColor('red');
            break;
        case 'amex':
            swapColor('green');
            break;
        case 'discover':
            swapColor('purple');
            break;
        default:
            swapColor('');
    }
}

// Event listeners
name.addEventListener('input', updateCardDisplay);
cardnumber_mask.on('accept', updateCardDisplay);
expirationdate_mask.on('accept', updateCardDisplay);
securitycode_mask.on('accept', updateCardDisplay);

// Card flip on security code focus
securitycode.addEventListener('focus', function() {
    document.querySelector('.creditcard').classList.add('flipped');
});

securitycode.addEventListener('blur', function() {
    document.querySelector('.creditcard').classList.remove('flipped');
});

// Generate random card
generatecard.addEventListener('click', function() {
    const testCards = [
        { number: '4111 1111 1111 1111', exp: '12/25', cvc: '123' },
        { number: '5555 5555 5555 4444', exp: '11/24', cvc: '456' },
        { number: '3782 822463 10005', exp: '10/26', cvc: '7893' },
        { number: '6011 1111 1111 1117', exp: '09/25', cvc: '321' }
    ];
    
    const randomCard = testCards[Math.floor(Math.random() * testCards.length)];
    
    name.value = 'Test User';
    cardnumber.value = randomCard.number;
    expirationdate.value = randomCard.exp;
    securitycode.value = randomCard.cvc;
    
    // Update masks
    cardnumber_mask.updateValue();
    expirationdate_mask.updateValue();
    securitycode_mask.updateValue();
    
    updateCardDisplay();
});

// Initial update
updateCardDisplay();

console.log('Simple card animation loaded successfully!');
</script>
</body>
{% endblock %} 