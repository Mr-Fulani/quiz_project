# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Stripe –¥–ª—è Production

## üìã –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### ‚úÖ –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ:
- [x] Stripe –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É donation
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–µ—Ö –≤–∞–ª—é—Ç: USD, EUR, RUB
- [x] –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [x] Webhook –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- [x] –ö—Ä–∞—Å–∏–≤—ã–π –¥–∏–∑–∞–π–Ω —Å SVG –∫–∞—Ä—Ç–∞–º–∏
- [x] –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è production:

## 1. üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Stripe Dashboard

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π:
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://dashboard.stripe.com
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –≤ **Live mode** (–ø—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Developers** ‚Üí **API keys**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **Publishable key** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `pk_live_`)
   - **Secret key** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk_live_`)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Developers** ‚Üí **Webhooks**
2. –ù–∞–∂–º–∏—Ç–µ **Add endpoint**
3. URL: `https://–≤–∞—à-–¥–æ–º–µ–Ω.com/donation/stripe-webhook/`
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è:
   - `payment_intent.succeeded`
   - `payment_intent.payment_failed`
   - `payment_intent.canceled`
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Webhook signing secret** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `whsec_`)

## 2. üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à `.env` —Ñ–∞–π–ª:

```bash
# Stripe Production Keys
STRIPE_PUBLISHABLE_KEY=pk_live_–≤–∞—à_–ø—É–±–ª–∏—á–Ω—ã–π_–∫–ª—é—á
STRIPE_SECRET_KEY=sk_live_–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á
STRIPE_WEBHOOK_SECRET=whsec_–≤–∞—à_webhook_—Å–µ–∫—Ä–µ—Ç
```

## 3. üöÄ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### üí≥ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–∞–ª—é—Ç—ã:
- **USD** ($) - –¥–æ–ª–ª–∞—Ä—ã –°–®–ê
- **EUR** (‚Ç¨) - –µ–≤—Ä–æ
- **RUB** (‚ÇΩ) - —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ —Ä—É–±–ª–∏

### üÉè –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã:
- **–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞:** `4242 4242 4242 4242`
- **–û—Ç–∫–ª–æ–Ω–µ–Ω–∞:** `4000 0000 0000 0002`
- **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤:** `4000 0000 0000 9995`
- **–¢—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:** `4000 0000 0000 3220`

### üì± –°—Ç—Ä–∞–Ω–∏—Ü—ã:
- **–û—Å–Ω–æ–≤–Ω–∞—è:** `/donation/` - –∫—Ä–∞—Å–∏–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å SVG –∞–Ω–∏–º–∞—Ü–∏–µ–π
- **–¢–µ—Å—Ç–æ–≤–∞—è:** `/donation/test/` - –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## 4. üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–µ–π:
- –ê–¥–º–∏–Ω–∫–∞ Django: `/admin/donation/donation/`
- Stripe Dashboard: https://dashboard.stripe.com/payments

### –õ–æ–≥–∏ webhook:
- Stripe Dashboard ‚Üí **Developers** ‚Üí **Webhooks** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à endpoint
- –õ–æ–≥–∏ Django –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞

## 5. üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
- [ ] HTTPS –≤–∫–ª—é—á–µ–Ω –Ω–∞ production
- [ ] Webhook secret –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Live –∫–ª—é—á–∏ –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ git
- [ ] CSRF –∑–∞—â–∏—Ç–∞ –≤–∫–ª—é—á–µ–Ω–∞
- [ ] Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è development/production
- –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ webhook secret
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ Stripe Dashboard

## 6. üêõ –û—Ç–ª–∞–¥–∫–∞

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

**"Stripe not available":**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ publishable key –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —à–∞–±–ª–æ–Ω
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Stripe.js –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**"Invalid signature" –≤ webhook:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook secret –≤ .env
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ URL webhook –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

**"Card declined":**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Stripe Dashboard –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–∞—Ä—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∞–ª—é—Ç—É

**–ü–ª–∞—Ç–µ–∂ –∑–∞–≤–∏—Å –≤ "pending":**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook –ª–æ–≥–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ webhook endpoint –¥–æ—Å—Ç—É–ø–µ–Ω

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Stripe CLI
stripe login
stripe listen --forward-to localhost:8001/donation/stripe-webhook/
```

## 7. üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

–í Stripe Dashboard –¥–æ—Å—Ç—É–ø–Ω—ã:
- –ì—Ä–∞—Ñ–∏–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∞–º
- –ê–Ω–∞–ª–∏–∑ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- –û—Ç—á–µ—Ç—ã –ø–æ –≤–∞–ª—é—Ç–∞–º

## 8. üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞:
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook –≤ Stripe CLI
3. –î–µ–ø–ª–æ–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ production webhook

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –≤ Stripe Dashboard
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ Django
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —É—Å–ø–µ—à–Ω–æ—Å—Ç—å webhook

---

## üéØ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–í–∞—à–∞ donation —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å Stripe –∏ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í—Å–µ –ø–ª–∞—Ç–µ–∂–∏ –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –Ω–∞–¥–µ–∂–Ω–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π webhook –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏. 