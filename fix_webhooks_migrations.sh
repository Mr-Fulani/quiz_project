#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–π –≤–µ–±—Ö—É–∫–æ–≤ –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω—ã–º –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º
# –≠—Ç–æ —Ä–µ—à–∏—Ç –ø—Ä–æ–±–ª–µ–º—É —Å push/pull –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏

set -e

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –≤–µ–±—Ö—É–∫–æ–≤..."
echo "====================================="

# –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π..."
mkdir -p backups/migrations/webhooks
cp -r quiz_backend/webhooks/migrations/* backups/migrations/webhooks/

echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ squash –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤..."
cd quiz_backend
python manage.py squashmigrations webhooks 0001 0009 --noinput

echo "üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π –≤–µ–±—Ö—É–∫–æ–≤..."
cd ../
rm -f quiz_backend/webhooks/migrations/000[1-9]_*.py
rm -f quiz_backend/webhooks/migrations/000[1-9][0-9]_*.py

echo "‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤–µ–±—Ö—É–∫–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã!"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–æ–≤–∞—è squash –º–∏–≥—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞"
echo "2. –°–¥–µ–ª–∞–π—Ç–µ –∫–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π"
echo "3. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –Ω–æ–≤—É—é squash –º–∏–≥—Ä–∞—Ü–∏—é"
echo "4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ/–º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"
echo ""
echo "‚ö†Ô∏è  –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ backups/migrations/webhooks/"
