# –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–∏–∫–∏ –∫–Ω–æ–ø–∫–∏ "–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ" –≤ Mini App

## –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –§—Ä–æ–Ω—Ç–µ–Ω–¥ (mini_app/static/js/profile.js, —Å—Ç—Ä–æ–∫–∏ 1762-1854)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏:**

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram WebApp** (—Å—Ç—Ä–æ–∫–∏ 1781-1797)
   - –ë–µ—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `window.Telegram.WebApp.initDataUnsafe.user`
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç `syncData` —Å –ø–æ–ª—è–º–∏:
     - `telegram_id`
     - `first_name`
     - `last_name`
     - `username`
     - `photo_url`
     - `language_code`

2. **–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥** (—Å—Ç—Ä–æ–∫–∏ 1809-1815)
   - POST –Ω–∞ `/api/accounts/miniapp-users/refresh_from_telegram/`
   - –ü–µ—Ä–µ–¥–∞–µ—Ç `syncData` –≤ body

3. **–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞** (—Å—Ç—Ä–æ–∫–∏ 1817-1840):
   - ‚ö†Ô∏è **–î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï**: –û–±–Ω–æ–≤–ª—è–µ—Ç `last_seen` (—Å—Ç—Ä–æ–∫–∏ 1823-1829)
   - –í—ã–∑—ã–≤–∞–µ—Ç `fetchProfileDataFromServer()` –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è (—Å—Ç—Ä–æ–∫–∞ 1836)
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ

---

### –ë—ç–∫–µ–Ω–¥ (quiz_backend/accounts/api/api_views.py, —Å—Ç—Ä–æ–∫–∏ 718-787)

**–ú–µ—Ç–æ–¥ `refresh_from_telegram`:**

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (—Å—Ç—Ä–æ–∫–∞ 733)
   - –ù–∞—Ö–æ–¥–∏—Ç `MiniAppUser` –ø–æ `telegram_id`

2. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** (—Å—Ç—Ä–æ–∫–∏ 738-744)
   - –ë–µ—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `request.data`

3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** (—Å—Ç—Ä–æ–∫–∞ 753)
   - –í—ã–∑—ã–≤–∞–µ—Ç `user.sync_from_telegram(telegram_data)`

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ last_seen** (—Å—Ç—Ä–æ–∫–∞ 759)
   - ‚ö†Ô∏è **–î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï**: –í—ã–∑—ã–≤–∞–µ—Ç `user.update_last_seen()`

5. **–í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö** (—Å—Ç—Ä–æ–∫–∏ 762-775)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä

---

### –ú–æ–¥–µ–ª—å MiniAppUser (quiz_backend/accounts/models.py, —Å—Ç—Ä–æ–∫–∏ 900-1095)

**–ú–µ—Ç–æ–¥ `sync_from_telegram`:**

1. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π** (—Å—Ç—Ä–æ–∫–∏ 935-1048):
   - `first_name` - –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
   - `last_name` - –¥–∞–∂–µ –µ—Å–ª–∏ –ø—É—Å—Ç–æ–µ (–≤–∞–∂–Ω–æ!)
   - `username` - –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
   - `telegram_photo_url` - –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
   - `language` - –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

2. **–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏** (—Å—Ç—Ä–æ–∫–∏ 987-1039):
   - –°–∫–∞—á–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ `photo_url`
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ø–æ–ª–µ `avatar` –º–æ–¥–µ–ª–∏
   - ‚ö†Ô∏è **–î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï**: –¢–∞–∫–∂–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤ `CustomUser` –µ—Å–ª–∏ –µ—Å—Ç—å —Å–≤—è–∑—å (—Å—Ç—Ä–æ–∫–∏ 1030-1036)

3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å CustomUser** (—Å—Ç—Ä–æ–∫–∏ 1054-1089):
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç `first_name`, `last_name`, `language`
   - ‚ö†Ô∏è **–î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï**: –ê–≤–∞—Ç–∞—Ä —É–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω –≤—ã—à–µ (—Å—Ç—Ä–æ–∫–∞ 1033)

4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** (—Å—Ç—Ä–æ–∫–∞ 1051)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è —á–µ—Ä–µ–∑ `update_fields`

---

## –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ùå 1. –î–≤–æ–π–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `last_seen`

**–ì–¥–µ:**
- –í –±—ç–∫–µ–Ω–¥–µ: `refresh_from_telegram` ‚Üí `user.update_last_seen()` (—Å—Ç—Ä–æ–∫–∞ 759)
- –í–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ: –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ ‚Üí –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ `update-last-seen/` (—Å—Ç—Ä–æ–∫–∏ 1823-1829)

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–∏—à–Ω–∏–π HTTP-–∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –Ω—É–∂–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∏–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞, —Ç–∞–∫ –∫–∞–∫ –±—ç–∫–µ–Ω–¥ —É–∂–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç `last_seen`.

---

### ‚ùå 2. –î–≤–æ–π–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è

**–ì–¥–µ:**
- –ë—ç–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ—Ç–≤–µ—Ç–µ (—Å—Ç—Ä–æ–∫–∏ 762-775)
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã–∑—ã–≤–∞–µ—Ç `fetchProfileDataFromServer()` (—Å—Ç—Ä–æ–∫–∞ 1836)

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–∏—à–Ω–∏–π HTTP-–∑–∞–ø—Ä–æ—Å. –î–∞–Ω–Ω—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ –æ—Ç–≤–µ—Ç–µ –æ—Ç `refresh_from_telegram`.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ –≤–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

---

### ‚ùå 3. –î–≤–æ–π–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏ —Å CustomUser

**–ì–¥–µ:**
- –í `sync_from_telegram` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ (—Å—Ç—Ä–æ–∫–∞ 1033)
- –í —Å–∏–≥–Ω–∞–ª–µ `post_save` –¥–ª—è `MiniAppUser` (accounts/signals.py, —Å—Ç—Ä–æ–∫–∞ 158)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ê–≤–∞—Ç–∞—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã.

**–†–µ—à–µ–Ω–∏–µ:** –û—Å—Ç–∞–≤–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. –õ—É—á—à–µ –≤ —Å–∏–≥–Ω–∞–ª–µ `post_save`, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º.

---

### ‚ö†Ô∏è 4. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ—Ç–≤–µ—Ç–µ

**–ì–¥–µ:**
- –ë—ç–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç—Ä–æ–∫–∞ 766)
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ, –∞ –¥–µ–ª–∞–µ—Ç –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å (—Å—Ç—Ä–æ–∫–∞ 1836)

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢—Ä–∞—Ç–∏–º —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI.

---

### ‚úÖ 5. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**–•–æ—Ä–æ—à–æ:** 
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `last_name` (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `update_fields` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π)

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `last_seen`

```javascript
// –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∏ 1821-1833):
await fetch('/api/accounts/miniapp-users/update-last-seen/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ telegram_id: telegramId })
});

// –î–û–õ–ñ–ù–û –ë–´–¢–¨: –£–±—Ä–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é, —Ç–∞–∫ –∫–∞–∫ –±—ç–∫–µ–Ω–¥ —É–∂–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç
```

---

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ –≤–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

```javascript
// –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 1836):
fetchProfileDataFromServer();

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
const result = await response.json();
if (result.success && result.user) {
    // –û–±–Ω–æ–≤–ª—è–µ–º UI –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –æ—Ç–≤–µ—Ç–∞
    updateProfileDOM(result.user);
    window.currentUser = result.user;
}
```

---

### 3. –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∞–≤–∞—Ç–∞—Ä–∫–∏

**–í–∞—Ä–∏–∞–Ω—Ç 1:** –£–±—Ä–∞—Ç—å –∏–∑ `sync_from_telegram` (—Å—Ç—Ä–æ–∫–∞ 1033), –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Å–∏–≥–Ω–∞–ª–µ
**–í–∞—Ä–∏–∞–Ω—Ç 2:** –£–±—Ä–∞—Ç—å –∏–∑ —Å–∏–≥–Ω–∞–ª–∞, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ `sync_from_telegram`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Å–∏–≥–Ω–∞–ª–µ, —Ç–∞–∫ –∫–∞–∫:
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ù–µ –Ω—É–∂–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É

---

## –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

```javascript
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"
elements.refreshBtn.onclick = async () => {
    console.log('üîÑ –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ" –Ω–∞–∂–∞—Ç–∞');
    showNotification('refreshing_data', 'info');
    
    const telegramId = window.currentUser?.telegram_id;
    if (!telegramId) {
        console.warn('‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω telegram_id –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö');
        showNotification('error', 'error');
        return;
    }
    
    try {
        // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram Mini App
        const telegramWebApp = window.Telegram?.WebApp;
        const telegramData = telegramWebApp?.initDataUnsafe?.user;
        
        const syncData = {
            telegram_id: telegramId,
            first_name: telegramData?.first_name || null,
            last_name: telegramData?.hasOwnProperty('last_name') ? (telegramData.last_name || '') : null,
            username: telegramData?.username || null,
            photo_url: telegramData?.photo_url || null,
            language_code: telegramData?.language_code || telegramWebApp?.initDataUnsafe?.user?.language_code || 'ru'
        };
        
        // –í—ã–∑—ã–≤–∞–µ–º endpoint –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram
        const response = await fetch('/api/accounts/miniapp-users/refresh_from_telegram/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(syncData)
        });
        
        if (response.ok) {
            const result = await response.json();
            console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ Telegram:', result);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
            if (result.success && result.user) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                window.currentUser = result.user;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º DOM –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
                updateProfileDOM(result.user);
                
                showNotification('data_refreshed', 'success');
            }
        } else {
            const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram:', errorData);
            showNotification('error', 'error');
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram:', error);
        showNotification('error', 'error');
    }
};
```

---

## –ò—Ç–æ–≥–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –£–±—Ä–∞—Ç—å (–ª–∏—à–Ω–µ–µ):

1. ‚úÖ –£–±—Ä–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ `update-last-seen/` –∏–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (—Å—Ç—Ä–æ–∫–∏ 1821-1833)
2. ‚úÖ –£–±—Ä–∞—Ç—å –≤—ã–∑–æ–≤ `fetchProfileDataFromServer()` (—Å—Ç—Ä–æ–∫–∞ 1836)
3. ‚ö†Ô∏è –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —É–±—Ä–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∞–≤–∞—Ç–∞—Ä–∫–∏ –∏–∑ `sync_from_telegram` (—Å—Ç—Ä–æ–∫–∞ 1033), –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Å–∏–≥–Ω–∞–ª–µ

### –î–æ–±–∞–≤–∏—Ç—å/–ò–∑–º–µ–Ω–∏—Ç—å:

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ `refresh_from_telegram` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
2. ‚úÖ –û–±–Ω–æ–≤–ª—è—Ç—å `window.currentUser` –∏–∑ –æ—Ç–≤–µ—Ç–∞
3. ‚úÖ –í—ã–∑—ã–≤–∞—Ç—å `updateProfileDOM()` –Ω–∞–ø—Ä—è–º—É—é —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞

### –û—Å—Ç–∞–≤–∏—Ç—å (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç):

1. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `last_seen` –≤ –±—ç–∫–µ–Ω–¥–µ
2. ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–≤–µ—Ç–µ
3. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (`last_name`)
4. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `update_fields` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–ë—ã–ª–æ:**
- 3 HTTP-–∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏
- –î–≤–æ–π–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏
- –î–≤–æ–π–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `last_seen`

**–°—Ç–∞–Ω–µ—Ç:**
- 1 HTTP-–∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏
- –û–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏
- –û–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `last_seen`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ—Ç–≤–µ—Ç–∞ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–£–ª—É—á—à–µ–Ω–∏—è:**
- ‚ö° –ë—ã—Å—Ç—Ä–µ–µ —Ä–∞–±–æ—Ç–∞ (–º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤)
- üíæ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- üîÑ –ú–µ–Ω—å—à–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

