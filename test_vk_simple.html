<!DOCTYPE html>
<html>
<head>
    <title>Test VK Share Simple</title>
</head>
<body>
    <h1>Test VK Share - Simple</h1>
    
    <button onclick="testVK()">Test VK Share</button>
    
    <script>
        function testVK() {
            // Имитируем URL с ngrok
            const url = 'https://0196d6086733.ngrok-free.app/ru/post/krutoj-promt/';
            const title = 'Крутой промт';
            
            console.log('Original URL:', url);
            
            // Создаем share URL
            const shareUrl = getShareUrl(url);
            console.log('Share URL:', shareUrl);
            
            // Для VK заменяем домен
            let vkUrl = shareUrl;
            if (shareUrl.includes('ngrok-free.app') || shareUrl.includes('localhost')) {
                vkUrl = shareUrl.replace(/https?:\/\/[^\/]+/, 'https://quiz-code.com');
            }
            console.log('VK URL after domain replacement:', vkUrl);
            
            // Убираем языковые префиксы
            vkUrl = vkUrl.replace('/ru/', '/').replace('/en/', '/');
            console.log('VK URL after language removal:', vkUrl);
            
            // Создаем финальный VK share URL
            const finalUrl = `https://vk.com/share.php?url=${encodeURIComponent(vkUrl)}`;
            console.log('Final VK URL:', finalUrl);
            
            // Открываем окно
            window.open(finalUrl, '_blank', 'width=600,height=400');
        }
        
        function getShareUrl(originalUrl) {
            if (originalUrl.includes('/share/')) {
                return originalUrl;
            }
            
            try {
                const urlObj = new URL(originalUrl);
                let path = urlObj.pathname;
                
                if (path.includes('/post/')) {
                    path = path.replace('/post/', '/share/post/');
                } else if (path.includes('/project/')) {
                    path = path.replace('/project/', '/share/project/');
                }
                
                urlObj.pathname = path;
                return urlObj.toString();
            } catch (error) {
                console.error('Error creating share URL:', error);
                return originalUrl;
            }
        }
    </script>
</body>
</html> 