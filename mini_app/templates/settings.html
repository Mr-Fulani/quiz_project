{% extends "base.html" %}

{% block title %}
{{ translations.get('settings_title', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏') }}
{% endblock %}

{% block content %}
<div class="settings-container">
    
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —è–∑—ã–∫–∞ -->
    <div class="settings-section">
        <h2 data-translate="language_settings">{{ translations.get('language_settings', '–Ø–∑—ã–∫') }}</h2>
        <div class="language-selector">
            {% for lang in supported_languages %}
            <button 
                class="language-btn {% if lang == current_language %}active{% endif %}" 
                onclick="changeLanguage('{{ lang }}')"
                data-lang="{{ lang }}"
            >
                {% if lang == 'en' %}üá∫üá∏ English{% endif %}
                {% if lang == 'ru' %}üá∑üá∫ –†—É—Å—Å–∫–∏–π{% endif %}
            </button>
            {% endfor %}
        </div>
    </div>
    
    <!-- –î—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div class="settings-section">
        <h2 data-translate="notifications">{{ translations.get('notifications', '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è') }}</h2>
        <div class="setting-item">
            <label class="switch">
                <input type="checkbox" id="notifications-toggle" checked>
                <span class="slider round"></span>
            </label>
            <span data-translate="notifications">{{ translations.get('notifications', '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è') }}</span>
        </div>
    </div>
    
    <!-- –°–∏—Å—Ç–µ–º–∞ –¥–æ–Ω–∞—Ç–æ–≤ -->
    <div class="settings-section">
        <h2 data-translate="support_project">{{ translations.get('support_project', '–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç') }}</h2>
        <div class="donation-container">
            <p class="donation-description" data-translate="donation_description">
                {{ translations.get('donation_description', '–ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —ç—Ç–æ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è') }}
            </p>
            
            <div class="donation-form">
                <h3 data-translate="donation_amount">{{ translations.get('donation_amount', '–°—É–º–º–∞ –¥–æ–Ω–∞—Ç–∞') }}</h3>
                
                <!-- –í—ã–±–æ—Ä —Å—É–º–º—ã -->
                <div class="amount-selector">
                    <span class="amount-option" data-amount="1">$1</span>
                    <span class="amount-option" data-amount="3">$3</span>
                    <span class="amount-option selected" data-amount="5">$5</span>
                    <span class="amount-option" data-amount="10">$10</span>
                    <span class="amount-option" data-amount="25">$25</span>
                    <span class="amount-option" data-amount="50">$50</span>
                </div>
                
                <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å—É–º–º—ã -->
                <div class="amount-input-container">
                    <input type="number" class="amount-input" min="1" step="0.01" 
                           data-translate-placeholder="donation_amount_placeholder" 
                           placeholder="{{ translations.get('donation_amount_placeholder', '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É') }}">
                </div>
                
                <!-- –í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã -->
                <div class="currency-selector">
                    <span class="currency-option selected" data-currency="usd" data-translate="donation_currency_usd">
                        {{ translations.get('donation_currency_usd', 'USD ($)') }}
                    </span>
                    <span class="currency-option" data-currency="eur" data-translate="donation_currency_eur">
                        {{ translations.get('donation_currency_eur', 'EUR (‚Ç¨)') }}
                    </span>
                    <span class="currency-option" data-currency="rub" data-translate="donation_currency_rub">
                        {{ translations.get('donation_currency_rub', 'RUB (‚ÇΩ)') }}
                    </span>
                </div>
                
                <!-- –ü–æ–ª—è –≤–≤–æ–¥–∞ -->
                <div class="input-group">
                    <label data-translate="donation_name_placeholder">{{ translations.get('donation_name_placeholder', '–í–∞—à–µ –∏–º—è') }}</label>
                    <input type="text" class="donation-name" required
                           data-translate-placeholder="donation_name_placeholder" 
                           placeholder="{{ translations.get('donation_name_placeholder', '–í–∞—à–µ –∏–º—è') }}">
                </div>
                
                <div class="input-group">
                    <label data-translate="donation_email_placeholder">{{ translations.get('donation_email_placeholder', '–í–∞—à email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)') }}</label>
                    <input type="email" class="donation-email"
                           data-translate-placeholder="donation_email_placeholder" 
                           placeholder="{{ translations.get('donation_email_placeholder', '–í–∞—à email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)') }}">
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–Ω–∞—Ç–∞ -->
                <button class="donate-btn" type="button">
                    <span data-translate="donate_button">{{ translations.get('donate_button', '–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å') }}</span>
                </button>
                
                <p class="min-amount" data-translate="donation_min_amount">
                    {{ translations.get('donation_min_amount', '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: $1') }}
                </p>
            </div>
        </div>
    </div>
    
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ -->
    <div class="settings-section">
        <h2 data-translate="about">{{ translations.get('about', '–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏') }}</h2>
        <div class="app-info">
            <p><strong data-translate="version">{{ translations.get('version', '–í–µ—Ä—Å–∏—è') }}</strong>: 1.0.0</p>
            <p data-translate="app_description">Educational quiz app for learning various topics</p>
            
            <!-- –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º" -->
            <div class="share-app-container">
                <button class="share-app-btn" type="button" onclick="if(window.shareApp) window.shareApp.showQRCode(); else console.log('ShareApp not ready');">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/>
                    </svg>
                    <span data-translate="share_app">{{ translations.get('share_app', '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º') }}</span>
                </button>
                <p class="share-app-description" data-translate="share_app_description">
                    {{ translations.get('share_app_description', '–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º —Å –¥—Ä—É–∑—å—è–º–∏') }}
                </p>
            </div>
        </div>
    </div>
</div>

<style>
.settings-container {
    padding: 20px;
    max-width: 600px;
    margin: 0 auto;
}

.settings-container h1 {
    text-align: center;
    margin-bottom: 30px;
    color: #333;
}

.settings-section {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.settings-section h2 {
    margin-bottom: 15px;
    color: #555;
    font-size: 18px;
}

.language-selector {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.language-btn {
    padding: 10px 20px;
    border: 2px solid #ddd;
    border-radius: 8px;
    background: white;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
}

.language-btn:hover {
    border-color: #007bff;
    background: #f8f9fa;
}

.language-btn.active {
    border-color: #007bff;
    background: #007bff;
    color: white;
}

.setting-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #eee;
}

.setting-item:last-child {
    border-bottom: none;
}

/* Switch —Å—Ç–∏–ª–∏ */
.switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
}

input:checked + .slider {
    background-color: #007bff;
}

input:focus + .slider {
    box-shadow: 0 0 1px #007bff;
}

input:checked + .slider:before {
    transform: translateX(26px);
}

.slider.round {
    border-radius: 34px;
}

.slider.round:before {
    border-radius: 50%;
}

.app-info {
    color: #666;
    line-height: 1.6;
}

.app-info p {
    margin: 5px 0;
}

.share-app-container {
    margin-top: 20px;
    text-align: center;
}

.share-app-description {
    font-size: 12px;
    color: #888;
    margin-top: 8px;
}
</style>

<script>
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram Web App
function isTelegramWebApp() {
    return window.Telegram && window.Telegram.WebApp;
}

// –§—É–Ω–∫—Ü–∏—è changeLanguage —Ç–µ–ø–µ—Ä—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ –≤ base.html

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π
document.addEventListener('DOMContentLoaded', function() {
    console.log('üîß Settings page DOM loaded');
    console.log('üîß window.localizationService:', window.localizationService);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const notificationsEnabled = localStorage.getItem('notifications') !== 'false';
    const savedLanguage = localStorage.getItem('selectedLanguage');
    
    let notificationsToggle = document.getElementById('notifications-toggle');
    if (notificationsToggle) {
        notificationsToggle.checked = notificationsEnabled;
    }
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —è–∑—ã–∫ –∏ –æ–Ω –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º
    if (savedLanguage && savedLanguage !== window.currentLanguage) {
        console.log('Restoring saved language:', savedLanguage);
        window.currentLanguage = savedLanguage;
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.querySelectorAll('.language-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        const activeBtn = document.querySelector(`[data-lang="${savedLanguage}"]`);
        if (activeBtn) {
            activeBtn.classList.add('active');
        }
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π
    if (notificationsToggle) {
        notificationsToggle.addEventListener('change', function(e) {
            localStorage.setItem('notifications', e.target.checked);
        });
    }
});
</script>
{% endblock %}