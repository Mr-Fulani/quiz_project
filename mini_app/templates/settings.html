{% extends "base.html" %}

{% block title %}
{{ translations.get('settings_title', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏') }}
{% endblock %}

{% block content %}
<div class="settings-container">
    <h1>{{ translations.get('settings_title', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏') }}</h1>
    
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —è–∑—ã–∫–∞ -->
    <div class="settings-section">
        <h2>{{ translations.get('language_settings', '–Ø–∑—ã–∫') }}</h2>
        <div class="language-selector">
            {% for lang in supported_languages %}
            <button 
                class="language-btn {% if lang == current_language %}active{% endif %}" 
                onclick="changeLanguage('{{ lang }}')"
                data-lang="{{ lang }}"
            >
                {% if lang == 'en' %}üá∫üá∏ English{% endif %}
                {% if lang == 'ru' %}üá∑üá∫ –†—É—Å—Å–∫–∏–π{% endif %}
            </button>
            {% endfor %}
        </div>
    </div>
    
    <!-- –î—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div class="settings-section">
        <h2>{{ translations.get('notifications', '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è') }}</h2>
        <div class="setting-item">
            <label class="switch">
                <input type="checkbox" id="notifications-toggle" checked>
                <span class="slider round"></span>
            </label>
            <span>{{ translations.get('notifications', '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è') }}</span>
        </div>
    </div>
    
    <div class="settings-section">
        <h2>{{ translations.get('dark_mode', '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞') }}</h2>
        <div class="setting-item">
            <label class="switch">
                <input type="checkbox" id="dark-mode-toggle">
                <span class="slider round"></span>
            </label>
            <span>{{ translations.get('dark_mode', '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞') }}</span>
        </div>
    </div>
    
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ -->
    <div class="settings-section">
        <h2>{{ translations.get('about', '–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏') }}</h2>
        <div class="app-info">
            <p><strong>{{ translations.get('version', '–í–µ—Ä—Å–∏—è') }}:</strong> 1.0.0</p>
            <p>Quiz Mini App - {{ translations.get('about', '–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏') }}</p>
        </div>
    </div>
</div>

<style>
.settings-container {
    padding: 20px;
    max-width: 600px;
    margin: 0 auto;
}

.settings-container h1 {
    text-align: center;
    margin-bottom: 30px;
    color: #333;
}

.settings-section {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.settings-section h2 {
    margin-bottom: 15px;
    color: #555;
    font-size: 18px;
}

.language-selector {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.language-btn {
    padding: 10px 20px;
    border: 2px solid #ddd;
    border-radius: 8px;
    background: white;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
}

.language-btn:hover {
    border-color: #007bff;
    background: #f8f9fa;
}

.language-btn.active {
    border-color: #007bff;
    background: #007bff;
    color: white;
}

.setting-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #eee;
}

.setting-item:last-child {
    border-bottom: none;
}

/* Switch —Å—Ç–∏–ª–∏ */
.switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
}

input:checked + .slider {
    background-color: #007bff;
}

input:focus + .slider {
    box-shadow: 0 0 1px #007bff;
}

input:checked + .slider:before {
    transform: translateX(26px);
}

.slider.round {
    border-radius: 34px;
}

.slider.round:before {
    border-radius: 50%;
}

.app-info {
    color: #666;
    line-height: 1.6;
}

.app-info p {
    margin: 5px 0;
}
</style>

<script>
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram Web App
function isTelegramWebApp() {
    return window.Telegram && window.Telegram.WebApp;
}

function changeLanguage(lang) {
    console.log('Changing language to:', lang);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
    document.querySelectorAll('.language-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-lang="${lang}"]`).classList.add('active');
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —è–∑—ã–∫ –≤ localStorage
    localStorage.setItem('selectedLanguage', lang);
    
    // –ï—Å–ª–∏ –≤ Telegram Web App, –∏—Å–ø–æ–ª—å–∑—É–µ–º Telegram API –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    if (isTelegramWebApp()) {
        console.log('Using Telegram Web App navigation');
        const newUrl = `/?lang=${lang}`;
        window.Telegram.WebApp.navigateTo(newUrl);
    } else {
        // –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é
        console.log('Using standard browser navigation');
        const currentUrl = new URL(window.location);
        currentUrl.searchParams.set('lang', lang);
        window.location.href = currentUrl.toString();
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π
document.addEventListener('DOMContentLoaded', function() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const notificationsEnabled = localStorage.getItem('notifications') !== 'false';
    const darkModeEnabled = localStorage.getItem('darkMode') === 'true';
    const savedLanguage = localStorage.getItem('selectedLanguage');
    
    document.getElementById('notifications-toggle').checked = notificationsEnabled;
    document.getElementById('dark-mode-toggle').checked = darkModeEnabled;
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —è–∑—ã–∫ –∏ –æ–Ω –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º
    if (savedLanguage && savedLanguage !== window.currentLanguage) {
        changeLanguage(savedLanguage);
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π
    document.getElementById('notifications-toggle').addEventListener('change', function(e) {
        localStorage.setItem('notifications', e.target.checked);
    });
    
    document.getElementById('dark-mode-toggle').addEventListener('change', function(e) {
        localStorage.setItem('darkMode', e.target.checked);
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
    });
});
</script>
{% endblock %}