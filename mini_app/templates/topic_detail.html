{% extends "base.html" %}

{% block title %}
{{ topic.name }} - Тема опроса
{% endblock %}

{% block content %}
<div class="topic-detail">
    <div class="topic-header">
        <img src="{{ topic.image_url }}" alt="{{ topic.name }}" class="topic-image">
        <div class="topic-info">
            <h1>{{ topic.name }}</h1>
            <p class="topic-description">{{ topic.description }}</p>
            <div class="topic-stats">
                <span class="difficulty difficulty-{{ topic.difficulty.lower() }}">
                    Сложность: {{ topic.difficulty }}
                </span>
                <span class="questions-count">
                    Вопросов: {{ topic.questions_count }}
                </span>
            </div>
        </div>
    </div>
    
    <div class="topic-actions">
        <button class="btn btn-primary" onclick="startQuiz({{ topic.id }})">
            Начать опрос
        </button>
        <button class="btn btn-secondary" onclick="goBack()">
            Вернуться назад
        </button>
    </div>
    
    <div class="topic-preview">
        <h3>О чём будет опрос:</h3>
        <ul class="preview-list">
            {% if topic.name == "Python" %}
                <li>Основы синтаксиса Python</li>
                <li>Работа с данными и структурами</li>
                <li>Объектно-ориентированное программирование</li>
                <li>Библиотеки и фреймворки</li>
            {% elif topic.name == "JavaScript" %}
                <li>Основы JavaScript</li>
                <li>DOM манипуляции</li>
                <li>Асинхронное программирование</li>
                <li>ES6+ возможности</li>
            {% elif topic.name == "React" %}
                <li>Компоненты и JSX</li>
                <li>State и Props</li>
                <li>Hooks и жизненный цикл</li>
                <li>Redux и состояние</li>
            {% else %}
                <li>Основные концепции</li>
                <li>Практические примеры</li>
                <li>Лучшие практики</li>
                <li>Продвинутые темы</li>
            {% endif %}
        </ul>
    </div>
</div>

<script>
function startQuiz(topicId) {
    console.log(`Starting quiz for topic ${topicId}`);
    
    // Добавим вибрацию для мобильных устройств
    if ('vibrate' in navigator) {
        navigator.vibrate(100);
    }
    
    // Здесь будет переход к опросу
    alert(`Запускаем опрос по теме "${topicId}"!\n\nЭта функция будет подключена к вашей системе опросов.`);
}

function goBack() {
    console.log('Going back to main page via AJAX...');
    
    // Используем AJAX навигацию для возврата на главную
    const loadMainPage = async () => {
        try {
            const contentContainer = document.querySelector('.content');
            if (!contentContainer) {
                console.log('Content container not found, using browser back');
                window.history.back();
                return;
            }
            
            // Показываем индикатор загрузки
            contentContainer.style.opacity = '0.7';
            
            const response = await fetch('/', {
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });
            
            if (response.ok) {
                const html = await response.text();
                
                // Парсим HTML и извлекаем контент
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const newContent = doc.querySelector('.content');
                
                if (newContent) {
                    // Плавно заменяем контент
                    setTimeout(() => {
                        contentContainer.innerHTML = newContent.innerHTML;
                        contentContainer.style.opacity = '1';
                        
                        // Обновляем URL в браузере
                        window.history.pushState({}, '', '/');
                        
                        // Обновляем активную навигацию
                        const navItems = document.querySelectorAll('.navigation .list');
                        navItems.forEach(item => {
                            item.classList.remove('active');
                            if (item.getAttribute('data-href') === '/') {
                                item.classList.add('active');
                            }
                        });
                        
                        // Перезапускаем скрипты карточек
                        if (window.initTopicCards) {
                            console.log('Reinitializing topic cards after back navigation...');
                            window.initTopicCards();
                        }
                        
                        console.log('Returned to main page via AJAX successfully');
                    }, 200);
                } else {
                    console.log('New content not found, using browser back');
                    window.history.back();
                }
            } else {
                console.log('AJAX request failed, using browser back');
                window.history.back();
            }
        } catch (error) {
            console.error('Error during AJAX back navigation:', error);
            window.history.back();
        }
    };
    
    loadMainPage();
}
</script>
{% endblock %} 