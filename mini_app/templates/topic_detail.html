{% extends "base.html" %}

{% block title %}
{{ topic.name }} - {{ translations.get('home', '–ì–ª–∞–≤–Ω–∞—è') }}
{% endblock %}

{% block extra_css %}
<style>
div.topic-detail-container div.subtopics-grid {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)) !important;
    gap: 20px !important;
}

@media (max-width: 1200px) {
    div.topic-detail-container div.subtopics-grid {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)) !important;
    }
}

@media (max-width: 768px) {
    div.topic-detail-container div.subtopics-grid {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) !important;
    }
}

@media (max-width: 480px) {
    div.topic-detail-container div.subtopics-grid {
        grid-template-columns: 1fr !important;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="topic-detail-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π "–ù–∞–∑–∞–¥" –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ç–µ–º—ã -->
    <header class="page-header">
        <div class="back-button" onclick="goBackToMain()">
            <i class="fas fa-arrow-left"></i>
            <span>{{ translations.get('back_button', '–ù–∞–∑–∞–¥') }}</span>
        </div>
        <h1>{{ topic.name }}</h1>
    </header>
    
    <div class="subtopics-grid" style="display: grid !important; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)) !important; gap: 20px !important;">
        {% for subtopic in subtopics %}
        <div class="subtopic-card" data-subtopic-id="{{ subtopic.id }}">
            <h3>{{ subtopic.name }}</h3>
            
            <div class="difficulty-bars">
                {% set total_q = subtopic.questions_count if subtopic.questions_count > 0 else 1 %}
                {% set se = subtopic.solved_counts.easy %}
                {% set sm = subtopic.solved_counts.medium %}
                {% set sh = subtopic.solved_counts.hard %}

                {% set te = subtopic.difficulty_counts.easy if subtopic.difficulty_counts.easy > 0 else 1 %}
                {% set tm = subtopic.difficulty_counts.medium if subtopic.difficulty_counts.medium > 0 else 1 %}
                {% set th = subtopic.difficulty_counts.hard if subtopic.difficulty_counts.hard > 0 else 1 %}

                <div class="diff-row">
                    <span class="diff-label">Easy</span>
                    <div class="diff-bar{% if subtopic.difficulty_counts.easy == 0 %} disabled{% endif %}" onclick="return openSubtopicLevel(this, {{ subtopic.id }}, 'easy', {{ subtopic.difficulty_counts.easy }})">
                        <div class="diff-fill"></div>
                        <div class="diff-solved easy" style="width: {{ (se / te * 100) | int }}%"></div>
                        {% if te > 0 %}<div class="diff-text">{{ se }}/{{ te }}</div>{% endif %}
                    </div>
                </div>
                <div class="diff-row">
                    <span class="diff-label">Medium</span>
                    <div class="diff-bar{% if subtopic.difficulty_counts.medium == 0 %} disabled{% endif %}" onclick="return openSubtopicLevel(this, {{ subtopic.id }}, 'medium', {{ subtopic.difficulty_counts.medium }})">
                        <div class="diff-fill"></div>
                        <div class="diff-solved medium" style="width: {{ (sm / tm * 100) | int }}%"></div>
                        {% if tm > 0 %}<div class="diff-text">{{ sm }}/{{ tm }}</div>{% endif %}
                    </div>
                </div>
                <div class="diff-row">
                    <span class="diff-label">Hard</span>
                    <div class="diff-bar{% if subtopic.difficulty_counts.hard == 0 %} disabled{% endif %}" onclick="return openSubtopicLevel(this, {{ subtopic.id }}, 'hard', {{ subtopic.difficulty_counts.hard }})">
                        <div class="diff-fill"></div>
                        <div class="diff-solved hard" style="width: {{ (sh / th * 100) | int }}%"></div>
                        {% if th > 0 %}<div class="diff-text">{{ sh }}/{{ th }}</div>{% endif %}
                    </div>
                </div>
                <div class="diff-row">
                    <span class="diff-label">All</span>
                    <div class="diff-bar" onclick="return openSubtopicLevel(this, {{ subtopic.id }}, 'all', {{ subtopic.questions_count }})">
                        <div class="diff-fill"></div>
                        <div class="diff-solved all" style="width: 100%"></div>
                        <div class="diff-text">{{ se+sm+sh }}/{{ subtopic.questions_count }}</div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% if not subtopics %}
    <div class="no-subtopics">
        <div class="no-subtopics-icon">üìù</div>
        <h3>{{ translations.get('no_achievements', '–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥—Ç–µ–º') }}</h3>
        <p>{{ translations.get('keep_learning', '–ü–æ–¥—Ç–µ–º—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–∑–∂–µ') }}</p>
    </div>
    {% endif %}
</div>

<script>
function startSubtopic(subtopicId) {
    console.log('Starting subtopic:', subtopicId);
    
    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∑–∞–¥–∞—á–∞–º–∏ –ø–æ–¥—Ç–µ–º—ã
    const currentLang = window.currentLanguage || 'en';
    const url = `/subtopic/${subtopicId}?lang=${currentLang}`;
    
    if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
        window.Telegram.WebApp.navigateTo(url);
    } else {
        window.location.href = url;
    }
}

// –§—É–Ω–∫—Ü–∏—è openSubtopicLevel –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ topic-detail.js
</script>
{% endblock %} 