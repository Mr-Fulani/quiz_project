{% extends "base.html" %}

{% block title %}
{{ translations.get('top_users_title', '–¢–æ–ø —é–∑–µ—Ä–æ–≤') }}
{% endblock %}

{% block content %}
<div class="top-users-container">
    <div class="filter-section">
        <div class="filter-controls">
            <div class="filter-group">
                <label class="filter-label" data-translate="gender">{{ translations.get('gender', '–ü–æ–ª') }}:</label>
                <select class="filter-select" id="gender-filter">
                    <option value="" data-translate="all">{{ translations.get('all', '–í—Å–µ') }}</option>
                    <option value="male" data-translate="male">{{ translations.get('male', '–ú—É–∂—Å–∫–æ–π') }}</option>
                    <option value="female" data-translate="female">{{ translations.get('female', '–ñ–µ–Ω—Å–∫–∏–π') }}</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label" data-translate="age">{{ translations.get('age', '–í–æ–∑—Ä–∞—Å—Ç') }}:</label>
                <select class="filter-select" id="age-filter">
                    <option value="" data-translate="all">{{ translations.get('all', '–í—Å–µ') }}</option>
                    <option value="18-25">18-25</option>
                    <option value="26-35">26-35</option>
                    <option value="36-45">36-45</option>
                    <option value="46+">46+</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label" data-translate="programming_language">{{ translations.get('programming_language', '–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è') }}:</label>
                <select class="filter-select" id="language-filter">
                    <option value="" data-translate="all">{{ translations.get('all', '–í—Å–µ') }}</option>
                    {% if programming_languages %}
                        {% for lang in programming_languages %}
                            <option value="{{ lang.name }}">{{ lang.name }}</option>
                        {% endfor %}
                    {% endif %}
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label" data-translate="rating">{{ translations.get('rating', '–†–µ–π—Ç–∏–Ω–≥') }}:</label>
                <select class="filter-select" id="rating-filter">
                    <option value="" data-translate="all">{{ translations.get('all', '–í—Å–µ') }}</option>
                    <option value="1000+">1000+</option>
                    <option value="500-999">500-999</option>
                    <option value="100-499">100-499</option>
                    <option value="0-99">0-99</option>
                </select>
            </div>
            
            <button class="filter-reset-btn" id="reset-filters" data-translate="reset_filters">
                {{ translations.get('reset_filters', '–°–±—Ä–æ—Å–∏—Ç—å') }}
            </button>
        </div>
    </div>
    
    <div class="top-users-list">
        {% if top_users %}
            {% for user in top_users %}
            <div class="user-item">
                <div class="user-rank">{{ loop.index }}</div>
                <div class="user-avatar-wrapper">
                    <img class="user-avatar" src="{{ user.avatar_url or '/static/images/default_avatar.png' }}" alt="{{ user.username }}">
                    {% if user.is_online %}
                    <div class="online-indicator"></div>
                    {% endif %}
                </div>
                <div class="user-info">
                    <h3 class="user-username">{{ user.username }}</h3>
                    <p class="user-name">{{ user.first_name }} {{ user.last_name }}</p>
                    <div class="user-stats">
                        <div class="stat-item">
                            <span class="stat-label" data-translate="rating">{{ translations.get('rating', '–†–µ–π—Ç–∏–Ω–≥') }}:</span>
                            <span class="stat-value">{{ user.rating }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label" data-translate="quizzes_completed">{{ translations.get('quizzes_completed', '–ö–≤–∏–∑–æ–≤') }}:</span>
                            <span class="stat-value">{{ user.quizzes_completed }}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label" data-translate="average_score">{{ translations.get('average_score', '–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª') }}:</span>
                            <span class="stat-value">{{ "%.1f"|format(user.average_score) }}%</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">üèÜ</div>
                <p data-translate="no_top_users">{{ translations.get('no_top_users', '–ü–æ–∫–∞ –Ω–µ—Ç –ª—É—á—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π') }}</p>
            </div>
        {% endif %}
    </div>
</div>

<script>
    // –ü–æ–¥–∫–ª—é—á–∞–µ–º JavaScript –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    const script = document.createElement('script');
    script.src = '{{ top_users_js_url }}';
    script.onload = function() {
        console.log('üìú top_users.js –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∏–ª—å—Ç—Ä...');
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ DOM
        if (typeof TopUsersFilter !== 'undefined') {
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    console.log('üîÑ DOM –≥–æ—Ç–æ–≤, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∏–ª—å—Ç—Ä...');
                    window.topUsersFilter = new TopUsersFilter();
                });
            } else {
                console.log('üîÑ DOM —É–∂–µ –≥–æ—Ç–æ–≤, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∏–ª—å—Ç—Ä...');
                window.topUsersFilter = new TopUsersFilter();
            }
        } else {
            console.error('‚ùå TopUsersFilter –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
    };
    document.head.appendChild(script);
</script>
{% endblock %}
