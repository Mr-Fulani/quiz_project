{% extends "base.html" %}

{% block title %}
{{ translations.get('home', '–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞') }}
{% endblock %}

{% block content %}
<!-- –ü–æ–∏—Å–∫ -->
<div class="search-container">
    <input type="text" id="search-input" placeholder="{{ translations.get('search_placeholder', '–ü–æ–∏—Å–∫ —Ç–µ–º...') }}" onkeyup="handleSearch(event)">
    <div class="search-results" id="search-results"></div>
</div>

<!-- –ì–∞–ª–µ—Ä–µ—è -->
<div class="gallery" id="gallery">
    <div class="gallery__container">
        <!-- –ö–∞–∂–¥—ã–π span –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É —Ç–µ–º—ã -->
        {% for topic in topics %}
        <span style="--i:{{ loop.index0 }};" class="topic-card" data-topic-id="{{ topic.id }}">
            <img src="{{ topic.image_url }}" alt="{{ topic.name }}">
            <div class="card-overlay always-visible">
                <h3>{{ topic.name }}</h3>
                <p class="difficulty">{{ topic.difficulty }}</p>
                <p class="questions">{{ topic.questions_count }} {{ translations.get('questions_count', '–≤–æ–ø—Ä–æ—Å–æ–≤') }}</p>
                <div class="card-actions">
                    <button class="btn-start" onclick="handleStartTopic(event, {{ topic.id }})">{{ translations.get('start_button', '–ù–∞—á–∞—Ç—å') }}</button>
                    <button class="btn-back" onclick="goBackFromCard(event)">{{ translations.get('back_button', '–ù–∞–∑–∞–¥') }}</button>
                </div>
            </div>
        </span>
        {% endfor %}
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
<script src="/static/js/topic-cards.js?v=1.4"></script>
<script src="/static/js/search.js?v=1.5"></script>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å"
function handleStartTopic(event, topicId) {
    console.log('üöÄ handleStartTopic called with topicId:', topicId);
    
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram Web App
    function isTelegramWebApp() {
        return window.Telegram && window.Telegram.WebApp;
    }
    
    // –§–æ—Ä–º–∏—Ä—É–µ–º URL —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ —è–∑—ã–∫–∞
    const currentLang = window.currentLanguage || 'en';
    const topicUrl = `/topic/${topicId}?lang=${currentLang}`;
    
    console.log('Navigating to:', topicUrl);
    
    // –ï—Å–ª–∏ –≤ Telegram Web App, –∏—Å–ø–æ–ª—å–∑—É–µ–º Telegram API –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    if (isTelegramWebApp()) {
        console.log('Using Telegram Web App navigation');
        window.Telegram.WebApp.navigateTo(topicUrl);
    } else {
        // –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é
        console.log('Using standard browser navigation');
        window.location.href = topicUrl;
    }
}

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ
window.handleStartTopic = handleStartTopic;
</script>
{% endblock %}