{% extends "base.html" %}

{% block title %}
{{ translations.get('profile_title', 'Профиль') }}
{% endblock %}

{% block extra_css %}
<!-- CSS классы управляются через JavaScript в base.html -->
{% endblock %}

{% block content %}
<div id="loader" class="loader-container">
    <div class="loader-text" data-translate="loading">{{ translations.get('loading', 'Загрузка профиля...') }}</div>
</div>
<div id="profile-container" class="profile-container" style="display: none;">
    <div class="profile-header">
        <div class="profile-avatar-container">
            <img id="profile-avatar" class="profile-avatar" src="/static/images/default_avatar.png" alt="Аватар пользователя">
        </div>
        <h1 id="profile-name" class="profile-name">Имя пользователя</h1>
        <p id="profile-username" class="profile-username">@username</p>
    </div>

    <!-- Профессиональная информация -->
    <div class="professional-section">
        <h2 class="progress-title" data-translate="professional_info">{{ translations.get('professional_info', 'Профессиональная информация') }}</h2>
        <div class="professional-info">
            <div class="info-item">
                <span class="info-label" data-translate="gender">{{ translations.get('gender', 'Пол') }}:</span>
                <span id="profile-gender" class="info-value" data-translate="not_specified">{{ translations.get('not_specified', 'Не указан') }}</span>
            </div>
            <div class="info-item">
                <span class="info-label" data-translate="birth_date">{{ translations.get('birth_date', 'Дата рождения') }}:</span>
                <span id="profile-birth-date" class="info-value" data-translate="not_specified">{{ translations.get('not_specified', 'Не указана') }}</span>
            </div>
            <div class="info-item">
                <span class="info-label" data-translate="grade">{{ translations.get('grade', 'Грейд') }}:</span>
                <span id="profile-grade" class="info-value" data-translate="not_specified">{{ translations.get('not_specified', 'Не указан') }}</span>
            </div>
            <div class="info-item">
                <span class="info-label" data-translate="technologies">{{ translations.get('technologies', 'Технологии') }}:</span>
                <div id="profile-technologies" class="info-value technologies-list">
                    <span class="no-data" data-translate="no_technologies">{{ translations.get('no_technologies', 'Технологии не указаны') }}</span>
                </div>
            </div>
        </div>
    </div>

    <div class="social-section">
        <h2 class="progress-title" data-translate="social_networks">{{ translations.get('social_networks', 'Социальные сети') }}</h2>
        <div id="social-links-container">
            <!-- Сюда будут добавляться социальные ссылки -->
            <p class="social-empty" data-translate="no_social_links">{{ translations.get('no_social_links', 'Социальные сети не указаны.') }}</p>
        </div>
    </div>

    <div class="profile-actions">
        <button id="edit-profile-btn" class="action-btn edit-btn">
            <span data-translate="edit_profile">{{ translations.get('edit_profile', 'Редактировать профиль') }}</span>
            <i class="fas fa-edit action-btn-icon"></i>
        </button>
        <button id="refresh-btn" class="action-btn refresh-btn">
            <span data-translate="refresh_data">{{ translations.get('refresh_data', 'Обновить данные') }}</span>
            <i class="fas fa-sync-alt action-btn-icon"></i>
        </button>
    </div>

    <!-- Модальное окно редактирования профиля -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-translate="edit_profile">{{ translations.get('edit_profile', 'Редактировать профиль') }}</h2>
                <span class="close">&times;</span>
            </div>
            <form id="edit-profile-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="avatar-input" data-translate="upload_avatars">{{ translations.get('upload_avatars', 'Аватарки (до 3)') }}:</label>
                    <input type="file" id="avatar-input" name="avatars" accept="image/*,.gif" multiple>
                    <p class="input-help" data-translate="avatars_help">{{ translations.get('avatars_help', 'Можно загрузить до 3 фото или GIF') }}</p>
                    
                    <!-- Текущие аватарки -->
                    <div class="avatars-preview" id="avatars-preview">
                        <!-- Аватарки будут добавлены через JavaScript -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="first-name-input" data-translate="first_name">{{ translations.get('first_name', 'Имя') }}:</label>
                    <input type="text" id="first-name-input" name="first_name" placeholder="{{ translations.get('first_name', 'Введите имя') }}">
                </div>
                
                <div class="form-group">
                    <label for="last-name-input" data-translate="last_name">{{ translations.get('last_name', 'Фамилия') }}:</label>
                    <input type="text" id="last-name-input" name="last_name" placeholder="{{ translations.get('last_name', 'Введите фамилию') }}">
                </div>
                
                <div class="form-group">
                    <label for="grade-input" data-translate="grade">{{ translations.get('grade', 'Грейд') }}:</label>
                    <select id="grade-input" name="grade">
                        <option value="" data-translate="select_grade">{{ translations.get('select_grade', 'Выберите грейд') }}</option>
                        <option value="junior" data-translate="grade_junior">{{ translations.get('grade_junior', 'Junior') }}</option>
                        <option value="middle" data-translate="grade_middle">{{ translations.get('grade_middle', 'Middle') }}</option>
                        <option value="senior" data-translate="grade_senior">{{ translations.get('grade_senior', 'Senior') }}</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="technologies-input" data-translate="technologies">{{ translations.get('technologies', 'Технологии') }}:</label>
                    <div id="technologies-container" class="technologies-selector">
                        <div class="technologies-loading" data-translate="loading_technologies">{{ translations.get('loading_technologies', 'Загрузка технологий...') }}</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="gender-input" data-translate="gender">{{ translations.get('gender', 'Пол') }}:</label>
                    <select id="gender-input" name="gender">
                        <option value="" data-translate="select_gender">{{ translations.get('select_gender', 'Выберите пол') }}</option>
                        <option value="male" data-translate="male">{{ translations.get('male', 'Мужской') }}</option>
                        <option value="female" data-translate="female">{{ translations.get('female', 'Женский') }}</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="birth-date-input" data-translate="birth_date">{{ translations.get('birth_date', 'Дата рождения') }}:</label>
                    <input type="date" id="birth-date-input" name="birth_date">
                </div>
                
                <div class="form-group">
                    <label for="website-input" data-translate="website">{{ translations.get('website', 'Веб-сайт') }}:</label>
                    <input type="url" id="website-input" name="website" placeholder="https://example.com">
                </div>
                
                <div class="form-group">
                    <label for="telegram-input" data-translate="telegram">{{ translations.get('telegram', 'Telegram') }}:</label>
                    <input type="text" id="telegram-input" name="telegram" placeholder="username">
                </div>
                
                <div class="form-group">
                    <label for="github-input" data-translate="github">{{ translations.get('github', 'GitHub') }}:</label>
                    <input type="url" id="github-input" name="github" placeholder="https://github.com/username">
                </div>
                
                <div class="form-group">
                    <label for="linkedin-input" data-translate="linkedin">{{ translations.get('linkedin', 'LinkedIn') }}:</label>
                    <input type="url" id="linkedin-input" name="linkedin" placeholder="https://linkedin.com/in/username">
                </div>
                
                <div class="form-group">
                    <label for="instagram-input" data-translate="instagram">{{ translations.get('instagram', 'Instagram') }}:</label>
                    <input type="url" id="instagram-input" name="instagram" placeholder="https://instagram.com/username">
                </div>
                
                <div class="form-group">
                    <label for="facebook-input" data-translate="facebook">{{ translations.get('facebook', 'Facebook') }}:</label>
                    <input type="url" id="facebook-input" name="facebook" placeholder="https://facebook.com/username">
                </div>
                
                <div class="form-group">
                    <label for="youtube-input" data-translate="youtube">{{ translations.get('youtube', 'YouTube') }}:</label>
                    <input type="url" id="youtube-input" name="youtube" placeholder="https://youtube.com/channel/...">
                </div>
                
                <!-- Настройка видимости профиля -->
                <div class="form-group profile-visibility-group">
                    <label class="profile-visibility-label">
                        <span data-translate="profile_visibility">{{ translations.get('profile_visibility', 'Видимость профиля') }}</span>
                    </label>
                    <div class="toggle-container">
                        <label class="toggle-switch">
                            <input type="checkbox" id="is-profile-public-input" name="is_profile_public" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label" id="profile-visibility-status" data-translate="public_profile">{{ translations.get('public_profile', 'Публичный профиль') }}</span>
                    </div>
                    <p class="profile-visibility-description" data-translate="profile_visibility_description">{{ translations.get('profile_visibility_description', 'Когда включено, другие пользователи могут просматривать информацию вашего профиля') }}</p>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" data-translate="cancel">{{ translations.get('cancel', 'Отмена') }}</button>
                    <button type="submit" class="btn-save" data-translate="save_changes">{{ translations.get('save_changes', 'Сохранить') }}</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Экран приглашения для неавторизованных пользователей -->
<div id="invitation-screen" class="invitation-screen" style="display: none;">
    <div class="invitation-container">
        <div class="invitation-header">
            <h1 class="invitation-title" data-translate="welcome_to_miniapp">{{ translations.get('welcome_to_miniapp', 'Добро пожаловать в QUIZ-CODE!') }}</h1>
            <p class="invitation-description" data-translate="miniapp_requires_telegram">{{ translations.get('miniapp_requires_telegram', 'Для использования мини-приложения необходимо открыть его через Telegram бота.') }}</p>
        </div>
        
        <div class="invitation-options">
            <div class="invitation-option">
                <div class="option-icon telegram-icon">
                    <i class="fab fa-telegram"></i>
                </div>
                <h3 class="option-title" data-translate="login_via_telegram">{{ translations.get('login_via_telegram', 'Войти через Telegram') }}</h3>
                <p class="option-description" data-translate="telegram_option_description">{{ translations.get('telegram_option_description', 'Откройте мини-приложение через Telegram бота для доступа ко всем функциям') }}</p>
                <a href="https://t.me/mr_proger_bot" target="_blank" class="option-button telegram-button" data-translate="open_telegram_bot">
                    {{ translations.get('open_telegram_bot', 'Открыть в Telegram') }}
                </a>
            </div>
            
            <div class="invitation-divider">
                <span data-translate="or">{{ translations.get('or', 'или') }}</span>
            </div>
            
            <div class="invitation-option">
                <div class="option-icon website-icon">
                    <i class="fas fa-globe"></i>
                </div>
                <h3 class="option-title" data-translate="register_on_website">{{ translations.get('register_on_website', 'Зарегистрироваться на сайте') }}</h3>
                <p class="option-description" data-translate="website_option_description">{{ translations.get('website_option_description', 'Создайте аккаунт на нашем сайте и получите доступ к аналогичному функционалу') }}</p>
                <a href="https://quiz-code.com/{{ current_language }}/?open_register=true" target="_blank" class="option-button website-button" data-translate="go_to_website">
                    {{ translations.get('go_to_website', 'Перейти на сайт') }}
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Backdrop для модального окна с аватарками -->
<div class="avatar-modal-backdrop" id="avatar-modal-backdrop"></div>

<!-- Модальное окно с галереей аватарок -->
<div class="avatar-modal" id="avatar-modal">
    <button class="avatar-modal-close" id="avatar-modal-close">&times;</button>
    <div class="swiper" id="avatar-swiper">
        <div class="swiper-wrapper" id="avatar-swiper-wrapper">
            <!-- Slides будут добавлены динамически через JavaScript -->
        </div>
        <!-- Навигация -->
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        <!-- Pagination -->
        <div class="swiper-pagination"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<!-- Swiper JS для модального окна аватарок -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="{{ get_js_url('profile.js') }}"></script>
{% endblock %}