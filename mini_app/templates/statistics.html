{% extends "base.html" %}

{% block title %}
{{ translations.get('statistics_title', '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞') }}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ statistics_css_url }}">
{% endblock %}

{% block content %}
<div class="statistics-container">
    <h1 data-translate="statistics_title">{{ translations.get('statistics_title', '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞') }}</h1>
    
    {% if user_statistics and user_statistics.stats %}
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <div class="stat-number">{{ user_statistics.stats.total_quizzes or 0 }}</div>
            <div class="stat-label" data-translate="total_questions">{{ translations.get('total_questions', '–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤') }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-number">{{ user_statistics.stats.completed_quizzes or 0 }}</div>
            <div class="stat-label" data-translate="correct_answers">{{ translations.get('correct_answers', '–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤') }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚ùå</div>
            <div class="stat-number">{{ user_statistics.stats.failed_quizzes or 0 }}</div>
            <div class="stat-label" data-translate="incorrect_answers">{{ translations.get('incorrect_answers', '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤') }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üéØ</div>
            <div class="stat-number">{{ user_statistics.stats.success_rate or 0 }}%</div>
            <div class="stat-label" data-translate="accuracy">{{ translations.get('accuracy', '–¢–æ—á–Ω–æ—Å—Ç—å') }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üî•</div>
            <div class="stat-number">{{ user_statistics.stats.current_streak or 0 }}</div>
            <div class="stat-label" data-translate="streak">{{ translations.get('streak', '–¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è') }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üèÜ</div>
            <div class="stat-number">{{ user_statistics.stats.best_streak or 0 }}</div>
            <div class="stat-label" data-translate="best_streak">{{ translations.get('best_streak', '–õ—É—á—à–∞—è —Å–µ—Ä–∏—è') }}</div>
        </div>
    </div>
    
    {% if user_statistics.topic_progress and user_statistics.topic_progress|length > 0 %}
    <div class="chart-container">
        <h2 data-translate="topic_progress">{{ translations.get('topic_progress', '–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–µ–º–∞–º') }}</h2>
        <div class="topic-progress-list">
            {% for topic in user_statistics.topic_progress %}
            <div class="topic-progress-item">
                <div class="topic-name">{{ topic.name }}</div>
                <div class="topic-stats">
                    <span class="topic-completed">{{ topic.completed }}</span>
                    <span class="topic-separator">/</span>
                    <span class="topic-total">{{ topic.total }}</span>
                    <span class="topic-percentage">({{ topic.percentage }}%)</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ topic.percentage }}%"></div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    {% if user_statistics.achievements and user_statistics.achievements|length > 0 %}
    <div class="chart-container">
        <h2 data-translate="achievements">{{ translations.get('achievements', '–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è') }}</h2>
        <div class="achievements-grid">
            {% for achievement in user_statistics.achievements %}
            <div class="achievement-item {% if achievement.unlocked %}unlocked{% else %}locked{% endif %}" 
                 data-achievement-id="{{ achievement.id }}"
                 data-achievement-name="{{ achievement.name }}"
                 data-achievement-description="{{ achievement.description or '' }}">
                <div class="achievement-icon">{{ achievement.icon }}</div>
                <div class="achievement-name">{{ achievement.name }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    {% else %}
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <div class="stat-number">0</div>
            <div class="stat-label" data-translate="total_questions">{{ translations.get('total_questions', '–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤') }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-number">0</div>
            <div class="stat-label" data-translate="correct_answers">{{ translations.get('correct_answers', '–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤') }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚ùå</div>
            <div class="stat-number">0</div>
            <div class="stat-label" data-translate="incorrect_answers">{{ translations.get('incorrect_answers', '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤') }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üéØ</div>
            <div class="stat-number">0%</div>
            <div class="stat-label" data-translate="accuracy">{{ translations.get('accuracy', '–¢–æ—á–Ω–æ—Å—Ç—å') }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üî•</div>
            <div class="stat-number">0</div>
            <div class="stat-label" data-translate="streak">{{ translations.get('streak', '–¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è') }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üèÜ</div>
            <div class="stat-number">0</div>
            <div class="stat-label" data-translate="best_streak">{{ translations.get('best_streak', '–õ—É—á—à–∞—è —Å–µ—Ä–∏—è') }}</div>
        </div>
    </div>
    
    <div class="chart-container">
        <h2 data-translate="statistics_title">{{ translations.get('statistics_title', '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞') }}</h2>
        <div class="chart-placeholder">
            <p data-translate="no_statistics_data">{{ translations.get('no_statistics_data', '–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è') }}</p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ statistics_js_url }}"></script>
<script>
// –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã JavaScript
console.log('StatisticsManager: HTML —Ç–µ—Å—Ç - JavaScript —Ä–∞–±–æ—Ç–∞–µ—Ç!');
document.addEventListener('DOMContentLoaded', function() {
    console.log('StatisticsManager: HTML —Ç–µ—Å—Ç - DOM –∑–∞–≥—Ä—É–∂–µ–Ω!');
    
    // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    setTimeout(function() {
        const achievements = document.querySelectorAll('.achievement-item');
        console.log('StatisticsManager: HTML —Ç–µ—Å—Ç - –Ω–∞–π–¥–µ–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π:', achievements.length);
        
        achievements.forEach(function(achievement, index) {
            console.log('StatisticsManager: HTML —Ç–µ—Å—Ç - –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ', index + 1, ':', achievement.dataset.achievementName);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ—Å—Ç–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
            achievement.addEventListener('click', function(e) {
                console.log('StatisticsManager: HTML —Ç–µ—Å—Ç - –ö–õ–ò–ö!', e.target);
                console.log('StatisticsManager: HTML —Ç–µ—Å—Ç - –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ:', achievement.dataset.achievementName);
                
                // –ü–æ–ª—É—á–∞–µ–º –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
                const achievementId = achievement.dataset.achievementId;
                const descriptions = {
                    '1': {
                        'en': 'Complete your first quiz to unlock this achievement!',
                        'ru': '–ü—Ä–æ–π–¥–∏—Ç–µ –ø–µ—Ä–≤—É—é –≤–∏–∫—Ç–æ—Ä–∏–Ω—É, —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ!'
                    },
                    '2': {
                        'en': 'Achieve 60% success rate to become an expert!',
                        'ru': '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 60% —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏, —á—Ç–æ–±—ã —Å—Ç–∞—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–æ–º!'
                    },
                    '4': {
                        'en': 'Answer 3 questions correctly in a row to unlock this streak!',
                        'ru': '–û—Ç–≤–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ 3 –≤–æ–ø—Ä–æ—Å–∞ –ø–æ–¥—Ä—è–¥, —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É —Å–µ—Ä–∏—é!'
                    },
                    '5': {
                        'en': 'Achieve 90% success rate to become a true expert!',
                        'ru': '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 90% —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏, —á—Ç–æ–±—ã —Å—Ç–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–º —ç–∫—Å–ø–µ—Ä—Ç–æ–º!'
                    }
                };
                
                const currentLang = window.currentLanguage || 'en';
                const description = descriptions[achievementId]?.[currentLang] || descriptions[achievementId]?.['en'] || achievement.dataset.achievementDescription;
                
                // –°–æ–∑–¥–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É –≤–º–µ—Å—Ç–æ alert
                const tooltip = document.createElement('div');
                tooltip.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.9);
                    color: #00ff00;
                    padding: 20px;
                    border-radius: 10px;
                    border: 2px solid #00ff00;
                    z-index: 10000;
                    font-size: 18px;
                    text-align: center;
                    box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
                    max-width: 300px;
                    word-wrap: break-word;
                `;
                tooltip.innerHTML = '<strong>' + achievement.dataset.achievementName + '</strong><br><br>' + description;
                document.body.appendChild(tooltip);
                
                // –£–¥–∞–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    if (tooltip.parentNode) {
                        tooltip.parentNode.removeChild(tooltip);
                    }
                }, 3000);
            });
        });
    }, 1000);
});
</script>
{% endblock %}